import{e as f,g as o}from"https://mzmpy.github.io/mynotes-es/chunks/js/chunk-WBJ4GZYY.js";o();o();o();o();o();o();o();o();o();function oe(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){let e=process.hrtime();i=e[0]*1e3+e[1]/1e6}else i=Date.now();return i}var F=class{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=oe(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(oe()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}};var U=class{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(let e of Object.values(this.stats))e.reset();return this}forEach(e){for(let t of Object.values(this.stats))e(t)}getTable(){let e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){let{name:t,type:r}=e,n=this.stats[t];return n||(e instanceof F?n=e:n=new F(t,r),this.stats[t]=n),n}};var je=class{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new U({id:e})),this.stats.get(e)}},me=new je;o();o();o();o();o();var ge=globalThis,or=globalThis.document||{},be=globalThis.process||{},ar=globalThis.console,Et=globalThis.navigator||{};o();o();function ye(i){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;let e=typeof navigator<"u"&&navigator.userAgent,t=i||e;return!!(t&&t.indexOf("Electron")>=0)}function S(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||ye()}o();function Xe(i){return!i&&!S()?"Node":ye(i)?"Electron":(i||Et.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}var Qe="4.1.0";o();function ur(i){try{let e=window[i],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}var xe=class{constructor(e,t,r="sessionStorage"){this.storage=ur(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){let t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){let t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};o();function Tt(i){let e;return i<10?e=`${i.toFixed(2)}ms`:i<100?e=`${i.toFixed(1)}ms`:i<1e3?e=`${i.toFixed(0)}ms`:e=`${(i/1e3).toFixed(2)}s`,e}function Pt(i,e=8){let t=Math.max(e-i.length,0);return`${" ".repeat(t)}${i}`}o();var ve;(function(i){i[i.BLACK=30]="BLACK",i[i.RED=31]="RED",i[i.GREEN=32]="GREEN",i[i.YELLOW=33]="YELLOW",i[i.BLUE=34]="BLUE",i[i.MAGENTA=35]="MAGENTA",i[i.CYAN=36]="CYAN",i[i.WHITE=37]="WHITE",i[i.BRIGHT_BLACK=90]="BRIGHT_BLACK",i[i.BRIGHT_RED=91]="BRIGHT_RED",i[i.BRIGHT_GREEN=92]="BRIGHT_GREEN",i[i.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",i[i.BRIGHT_BLUE=94]="BRIGHT_BLUE",i[i.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",i[i.BRIGHT_CYAN=96]="BRIGHT_CYAN",i[i.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(ve||(ve={}));var lr=10;function At(i){return typeof i!="string"?i:(i=i.toUpperCase(),ve[i]||ve.WHITE)}function _t(i,e,t){return!S&&typeof i=="string"&&(e&&(i=`\x1B[${At(e)}m${i}\x1B[39m`),t&&(i=`\x1B[${At(t)+lr}m${i}\x1B[49m`)),i}o();function Ct(i,e=["constructor"]){let t=Object.getPrototypeOf(i),r=Object.getOwnPropertyNames(t),n=i;for(let s of r){let a=n[s];typeof a=="function"&&(e.find(h=>s===h)||(n[s]=a.bind(i)))}}o();function ae(i,e){if(!i)throw new Error(e||"Assertion failed")}o();function $(){let i;if(S()&&ge.performance)i=ge?.performance?.now?.();else if("hrtime"in be){let e=be?.hrtime?.();i=e[0]*1e3+e[1]/1e6}else i=Date.now();return i}var k={debug:S()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},hr={enabled:!0,level:0};function O(){}var Bt={},Lt={once:!0},R=class{constructor({id:e}={id:""}){this.VERSION=Qe,this._startTs=$(),this._deltaTs=$(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new xe(`__probe-${this.id}__`,hr),this.timeStamp(`${this.id} started`),Ct(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number(($()-this._startTs).toPrecision(10))}getDelta(){return Number(($()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,k.warn,arguments,Lt)}error(e){return this._getLogFunction(0,e,k.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,k.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,k.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,k.debug||k.info,arguments,Lt)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||O,r&&[r],{tag:fr(t)}):O}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||O)}group(e,t,r={collapsed:!1}){let n=Dt({logLevel:e,message:t,opts:r}),{collapsed:s}=r;return n.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t,r={}){return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||O)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=It(e)}_getLogFunction(e,t,r,n,s){if(this._shouldLog(e)){s=Dt({logLevel:e,message:t,args:n,opts:s}),r=r||s.method,ae(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=$();let a=s.tag||s.message;if(s.once&&a)if(!Bt[a])Bt[a]=$();else return O;return t=dr(this.id,s.message,s),r.bind(console,t,...s.args)}return O}};R.VERSION=Qe;function It(i){if(!i)return 0;let e;switch(typeof i){case"number":e=i;break;case"object":e=i.logLevel||i.priority||0;break;default:return 0}return ae(Number.isFinite(e)&&e>=0),e}function Dt(i){let{logLevel:e,message:t}=i;i.logLevel=It(e);let r=i.args?Array.from(i.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),i.message=e;break;case"object":Object.assign(i,e);break;default:}typeof i.message=="function"&&(i.message=i.message());let n=typeof i.message;return ae(n==="string"||n==="object"),Object.assign(i,{args:r},i.opts)}function dr(i,e,t){if(typeof e=="string"){let r=t.time?Pt(Tt(t.total)):"";e=t.time?`${i}: ${r}  ${e}`:`${i}: ${e}`,e=_t(e,t.color,t.background)}return e}function fr(i){for(let e in i)for(let t in i[e])return t||"untitled";return"empty"}o();globalThis.probe={};var hn=new R({id:"@probe.gl/log"});var d=new R({id:"luma.gl"});o();var qe={};function M(i="id"){qe[i]=qe[i]||1;let e=qe[i]++;return`${i}-${e}`}o();o();var p=class{toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,t,r){if(!e)throw new Error("no device");this._device=e,this.props=pr(t,r);let n=this.props.id!=="undefined"?this.props.id:M(this[Symbol.toStringTag]);this.props.id=n,this.id=n,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(let e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){let e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){let r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){let t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){let e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}};f(p,"defaultProps",{id:"undefined",handle:void 0,userData:void 0});function pr(i,e){let t={...e};for(let r in i)i[r]!==void 0&&(t[r]=i[r]);return t}var ce=class extends p{get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,t){let r={...t};(t.usage||0)&ce.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?r.indexType="uint32":t.data instanceof Uint16Array&&(r.indexType="uint16")),delete r.data,super(e,r,ce.defaultProps),this.usage=r.usage||0,this.indexType=r.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}debugData=new ArrayBuffer(0);_setDebugData(e,t,r){let n=ArrayBuffer.isView(e)?e.buffer:e,s=Math.min(e?e.byteLength:r,ce.DEBUG_DATA_MAX_LENGTH);n===null?this.debugData=new ArrayBuffer(s):t===0&&r===n.byteLength?this.debugData=n.slice(0,s):this.debugData=n.slice(t,t+s)}},g=ce;f(g,"INDEX",16),f(g,"VERTEX",32),f(g,"UNIFORM",64),f(g,"STORAGE",128),f(g,"INDIRECT",256),f(g,"QUERY_RESOLVE",512),f(g,"MAP_READ",1),f(g,"MAP_WRITE",2),f(g,"COPY_SRC",4),f(g,"COPY_DST",8),f(g,"DEBUG_DATA_MAX_LENGTH",32),f(g,"defaultProps",{...p.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",onMapped:void 0});o();o();function ue(i){let[e,t,r]=Ze[i],n=i.includes("norm"),s=!n&&!i.startsWith("float"),a=i.startsWith("s");return{signedType:e,primitiveType:t,byteLength:r,normalized:n,integer:s,signed:a}}function Je(i){let e=i;switch(e){case"uint8":return"unorm8";case"sint8":return"snorm8";case"uint16":return"unorm16";case"sint16":return"snorm16";default:return e}}function Rt(i,e){switch(e){case 1:return i;case 2:return i+i%2;default:return i+(4-i%4)%4}}function Ke(i){let e=ArrayBuffer.isView(i)?i.constructor:i;if(e===Uint8ClampedArray)return"uint8";let t=Object.values(Ze).find(r=>e===r[4]);if(!t)throw new Error(e.name);return t[0]}function mr(i){let[,,,,e]=Ze[i];return e}var Ze={uint8:["uint8","u32",1,!1,Uint8Array],sint8:["sint8","i32",1,!1,Int8Array],unorm8:["uint8","f32",1,!0,Uint8Array],snorm8:["sint8","f32",1,!0,Int8Array],uint16:["uint16","u32",2,!1,Uint16Array],sint16:["sint16","i32",2,!1,Int16Array],unorm16:["uint16","u32",2,!0,Uint16Array],snorm16:["sint16","i32",2,!0,Int16Array],float16:["float16","f16",2,!1,Uint16Array],float32:["float32","f32",4,!1,Float32Array],uint32:["uint32","u32",4,!1,Uint32Array],sint32:["sint32","i32",4,!1,Int32Array]};function P(i){let e;i.endsWith("-webgl")&&(i.replace("-webgl",""),e=!0);let[t,r]=i.split("x"),n=t,s=r?parseInt(r):1,a=ue(n),h={type:n,components:s,byteLength:a.byteLength*s,integer:a.integer,signed:a.signed,normalized:a.normalized};return e&&(h.webglOnly=!0),h}function Mt(i,e,t){let r=t?Je(i):i;switch(r){case"unorm8":return e===1?"unorm8":e===3?"unorm8x3-webgl":`${r}x${e}`;case"snorm8":case"uint8":case"sint8":case"uint16":case"sint16":case"unorm16":case"snorm16":case"float16":if(e===1||e===3)throw new Error(`size: ${e}`);return`${r}x${e}`;default:return e===1?r:`${r}x${e}`}}function gr(i,e,t){if(!e||e>4)throw new Error(`size ${e}`);let r=e,n=Ke(i);return Mt(n,r,t)}function Ft(i){let e;switch(i.primitiveType){case"f32":e="float32";break;case"i32":e="sint32";break;case"u32":e="uint32";break;case"f16":return i.components<=2?"float16x2":"float16x4"}return i.components===1?e:`${e}x${i.components}`}o();o();var w="texture-compression-bc",b="texture-compression-astc",A="texture-compression-etc2",br="texture-compression-etc1-webgl",we="texture-compression-pvrtc-webgl",et="texture-compression-atc-webgl",Se="float32-renderable-webgl",tt="float16-renderable-webgl",yr="rgb9e5ufloat-renderable-webgl",rt="snorm8-renderable-webgl",le="norm16-renderable-webgl",it="snorm16-renderable-webgl",Ee="float32-filterable",$t="float16-filterable-webgl";function nt(i){let e=wr[i];if(!e)throw new Error(`Unsupported texture format ${i}`);return e}var xr={r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:rt},rg8snorm:{render:rt},"rgb8snorm-webgl":{},rgba8snorm:{render:rt},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:le},rg16unorm:{render:le},"rgb16unorm-webgl":{f:le},rgba16unorm:{render:le},r16snorm:{f:it},rg16snorm:{render:it},"rgb16snorm-webgl":{f:le},rgba16snorm:{render:it},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:tt,filter:"float16-filterable-webgl"},rg16float:{render:tt,filter:$t},rgba16float:{render:tt,filter:$t},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:Se,filter:Ee},rg32float:{render:!1,filter:Ee},"rgb32float-webgl":{render:Se,filter:Ee},rgba32float:{render:Se,filter:Ee},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:yr},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Se},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0}},vr={"bc1-rgb-unorm-webgl":{f:w},"bc1-rgb-unorm-srgb-webgl":{f:w},"bc1-rgba-unorm":{f:w},"bc1-rgba-unorm-srgb":{f:w},"bc2-rgba-unorm":{f:w},"bc2-rgba-unorm-srgb":{f:w},"bc3-rgba-unorm":{f:w},"bc3-rgba-unorm-srgb":{f:w},"bc4-r-unorm":{f:w},"bc4-r-snorm":{f:w},"bc5-rg-unorm":{f:w},"bc5-rg-snorm":{f:w},"bc6h-rgb-ufloat":{f:w},"bc6h-rgb-float":{f:w},"bc7-rgba-unorm":{f:w},"bc7-rgba-unorm-srgb":{f:w},"etc2-rgb8unorm":{f:A},"etc2-rgb8unorm-srgb":{f:A},"etc2-rgb8a1unorm":{f:A},"etc2-rgb8a1unorm-srgb":{f:A},"etc2-rgba8unorm":{f:A},"etc2-rgba8unorm-srgb":{f:A},"eac-r11unorm":{f:A},"eac-r11snorm":{f:A},"eac-rg11unorm":{f:A},"eac-rg11snorm":{f:A},"astc-4x4-unorm":{f:b},"astc-4x4-unorm-srgb":{f:b},"astc-5x4-unorm":{f:b},"astc-5x4-unorm-srgb":{f:b},"astc-5x5-unorm":{f:b},"astc-5x5-unorm-srgb":{f:b},"astc-6x5-unorm":{f:b},"astc-6x5-unorm-srgb":{f:b},"astc-6x6-unorm":{f:b},"astc-6x6-unorm-srgb":{f:b},"astc-8x5-unorm":{f:b},"astc-8x5-unorm-srgb":{f:b},"astc-8x6-unorm":{f:b},"astc-8x6-unorm-srgb":{f:b},"astc-8x8-unorm":{f:b},"astc-8x8-unorm-srgb":{f:b},"astc-10x5-unorm":{f:b},"astc-10x5-unorm-srgb":{f:b},"astc-10x6-unorm":{f:b},"astc-10x6-unorm-srgb":{f:b},"astc-10x8-unorm":{f:b},"astc-10x8-unorm-srgb":{f:b},"astc-10x10-unorm":{f:b},"astc-10x10-unorm-srgb":{f:b},"astc-12x10-unorm":{f:b},"astc-12x10-unorm-srgb":{f:b},"astc-12x12-unorm":{f:b},"astc-12x12-unorm-srgb":{f:b},"pvrtc-rgb4unorm-webgl":{f:we},"pvrtc-rgba4unorm-webgl":{f:we},"pvrtc-rbg2unorm-webgl":{f:we},"pvrtc-rgba2unorm-webgl":{f:we},"etc1-rbg-unorm-webgl":{f:br},"atc-rgb-unorm-webgl":{f:et},"atc-rgba-unorm-webgl":{f:et},"atc-rgbai-unorm-webgl":{f:et}},wr={...xr,...vr};var Sr=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],Er=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/,st=class{getInfo(e){return Gt(e)}isColor(e){return e.startsWith("rgba")||e.startsWith("bgra")||e.startsWith("rgb")}isDepthStencil(e){return e.startsWith("depth")||e.startsWith("stencil")}isCompressed(e){return Sr.some(t=>e.startsWith(t))}getCapabilities(e){let t=nt(e),r={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},n=Gt(e),s=e.startsWith("depth")||e.startsWith("stencil"),a=n?.signed,h=n?.integer,m=n?.webgl;return r.render&&=!a,r.filter&&=!s&&!a&&!h&&!m,r}},he=new st;function Gt(i){let e=Tr(i);if(he.isCompressed(i)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;let r=Pr(i);r&&(e.blockWidth=r.blockWidth,e.blockHeight=r.blockHeight)}let t=Er.exec(i);if(t){let[,r,n,s,a,h]=t,m=`${s}${n}`,x=ue(m),v=x.byteLength*8,T=r.length,Ye=[v,T>=2?v:0,T>=3?v:0,T>=4?v:0];e={format:i,attachment:e.attachment,dataType:x.signedType,components:T,channels:r,integer:x.integer,signed:x.signed,normalized:x.normalized,bitsPerChannel:Ye,bytesPerPixel:x.byteLength*r.length,packed:e.packed,srgb:e.srgb},h==="-webgl"&&(e.webgl=!0),a==="-srgb"&&(e.srgb=!0)}return i.endsWith("-webgl")&&(e.webgl=!0),i.endsWith("-srgb")&&(e.srgb=!0),e}function Tr(i){let e=nt(i),t=e.bytesPerPixel||1,r=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:i,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:t,bitsPerChannel:r,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function Pr(i){let t=/.*-(\d+)x(\d+)-.*/.exec(i);if(t){let[,r,n]=t;return{blockWidth:Number(r),blockHeight:Number(n)}}return null}o();function zt(i){return typeof ImageData<"u"&&i instanceof ImageData||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement||typeof VideoFrame<"u"&&i instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas}function Wt(i){if(typeof ImageData<"u"&&i instanceof ImageData||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas)return{width:i.width,height:i.height};if(typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement)return{width:i.naturalWidth,height:i.naturalHeight};if(typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement)return{width:i.videoWidth,height:i.videoHeight};if(typeof VideoFrame<"u"&&i instanceof VideoFrame)return{width:i.displayWidth,height:i.displayHeight};throw new Error("Unknown image type")}var de=class{features;disabledFeatures;constructor(e=[],t){this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}},ot=class{get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}id;props;userData={};statsManager=me;timestamp=0;_reused=!1;_lumaData={};_textureCaps={};constructor(e){this.props={...ot.defaultProps,...e},this.id=this.props.id||M(this[Symbol.toStringTag].toLowerCase())}getVertexFormatInfo(e){return P(e)}isVertexFormatSupported(e){return!0}getTextureFormatInfo(e){return he.getInfo(e)}getTextureFormatCapabilities(e){let t=this._textureCaps[e];if(!t){let r=this._getDeviceTextureFormatCapabilities(e);t=this._getDeviceSpecificTextureFormatCapabilities(r),this._textureCaps[e]=t}return t}getMipLevelCount(e,t,r=1){let n=Math.max(e,t,r);return 1+Math.floor(Math.log2(n))}isExternalImage(e){return zt(e)}getExternalImageSize(e){return Wt(e)}isTextureFormatSupported(e){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return he.isCompressed(e)}pushDebugGroup(e){this.commandEncoder.pushDebugGroup(e)}popDebugGroup(){this.commandEncoder?.popDebugGroup()}insertDebugMarker(e){this.commandEncoder?.insertDebugMarker(e)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(e,t,...r){return this.props.onError(e,t)?()=>{}:d.error(e.message,t,...r)}debug(){if(this.props.debug)debugger;else{let e=`'Type luma.log.set({debug: true}) in console to enable debug breakpoints',
or create a device with the 'debug: true' prop.`;d.once(0,e)()}}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(e){return this.commandEncoder.beginRenderPass(e)}beginComputePass(e){return this.commandEncoder.beginComputePass(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_getDeviceTextureFormatCapabilities(e){let t=he.getCapabilities(e),r=s=>(typeof s=="string"?this.features.has(s):s)??!0,n=r(t.create);return{format:e,create:n,render:n&&r(t.render),filter:n&&r(t.filter),blend:n&&r(t.blend),store:n&&r(t.store)}}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});let t={...e};if((e.usage||0)&g.INDEX&&(e.indexType||(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array&&(t.indexType="uint16")),!t.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return t}},D=ot;f(D,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(e,t)=>{},onResize:(e,t)=>{let[r,n]=e.getDevicePixelSize();d.log(1,`${e} resized => ${r}x${n}px`)()},onPositionChange:(e,t)=>{let[r,n]=e.getPosition();d.log(1,`${e} repositioned => ${r},${n}`)()},onVisibilityChange:e=>d.log(1,`${e} Visibility changed ${e.isVisible}`)(),onDevicePixelRatioChange:(e,t)=>d.log(1,`${e} DPR changed ${t.oldRatio} => ${e.devicePixelRatio}`)(),debug:d.get("debug")||void 0,debugShaders:d.get("debug-shaders")||void 0,debugFramebuffers:!!d.get("debug-framebuffers"),debugFactories:!!d.get("debug-factories"),debugWebGL:!!d.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0});var Ar="set luma.log.level=1 (or higher) to trace rendering",Ut="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",Pe=class{stats=me;log=d;VERSION="9.2.5";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw d.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),d.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");d.error("This version of luma.gl has already been initialized")()}d.log(1,`${this.VERSION} - ${Ar}`)(),globalThis.luma=this}async createDevice(e={}){let t={...Pe.defaultProps,...e},r=this.selectAdapter(t.type,t.adapters);if(!r)throw new Error(Ut);return t.waitForPageLoad&&await r.pageLoaded,await r.create(t)}async attachDevice(e,t){let r=this._getTypeFromHandle(e,t.adapters),n=r&&this.selectAdapter(r,t.adapters);if(!n)throw new Error(Ut);return await n?.attach?.(e,t)}registerAdapters(e){for(let t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){let t=this._getAdapterMap(e);return Array.from(t).map(([,r])=>r).filter(r=>r.isSupported?.()).map(r=>r.type)}getBestAvailableAdapterType(e=[]){let t=["webgpu","webgl","null"],r=this._getAdapterMap(e);for(let n of t)if(r.get(n)?.isSupported?.())return n;return null}selectAdapter(e,t=[]){let r=e;e==="best-available"&&(r=this.getBestAvailableAdapterType(t));let n=this._getAdapterMap(t);return r&&n.get(r)||null}enforceWebGL2(e=!0,t=[]){let n=this._getAdapterMap(t).get("webgl");n||d.warn("enforceWebGL2: webgl adapter not found")(),n?.enforceWebGL2?.(e)}setDefaultDeviceProps(e){Object.assign(Pe.defaultProps,e)}_getAdapterMap(e=[]){let t=new Map(this.preregisteredAdapters);for(let r of e)t.set(r.type,r);return t}_getTypeFromHandle(e,t=[]){return e instanceof WebGL2RenderingContext?"webgl":typeof GPUDevice<"u"&&e instanceof GPUDevice||e?.queue?"webgpu":e===null?"null":(e instanceof WebGLRenderingContext?d.warn("WebGL1 is not supported",e)():d.warn("Unknown handle type",e)(),null)}},Te=Pe;f(Te,"defaultProps",{...D.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0});var _r=new Te;o();var at=class{get pageLoaded(){return Lr()}},Cr=S()&&typeof document<"u",Br=()=>Cr&&document.readyState==="complete",Ae=null;function Lr(){return Ae||(Br()||typeof window>"u"?Ae=Promise.resolve():Ae=new Promise(i=>window.addEventListener("load",()=>i()))),Ae}o();o();function kt(){let i,e;return{promise:new Promise((r,n)=>{i=r,e=n}),resolve:i,reject:e}}var H=class{static isHTMLCanvas(e){return typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement}static isOffscreenCanvas(e){return typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}id;props;canvas;htmlCanvas;offscreenCanvas;type;initialized;isInitialized=!1;isVisible=!0;cssWidth;cssHeight;devicePixelRatio;devicePixelWidth;devicePixelHeight;drawingBufferWidth;drawingBufferHeight;_initializedResolvers=kt();_resizeObserver;_intersectionObserver;_position;destroyed=!1;toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...H.defaultProps,...e},e=this.props,this.initialized=this._initializedResolvers.promise,S()?e.canvas?typeof e.canvas=="string"?this.canvas=Ir(e.canvas):this.canvas=e.canvas:this.canvas=Rr(e):this.canvas={width:e.width||1,height:e.height||1},H.isHTMLCanvas(this.canvas)?(this.id=e.id||this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):H.isOffscreenCanvas(this.canvas)?(this.id=e.id||"offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas):(this.id=e.id||"node-canvas-context",this.type="node"),this.cssWidth=this.htmlCanvas?.clientWidth||this.canvas.width,this.cssHeight=this.htmlCanvas?.clientHeight||this.canvas.height,this.devicePixelWidth=this.canvas.width,this.devicePixelHeight=this.canvas.height,this.drawingBufferWidth=this.canvas.width,this.drawingBufferHeight=this.canvas.height,this.devicePixelRatio=globalThis.devicePixelRatio||1,this._position=[0,0],H.isHTMLCanvas(this.canvas)){this._intersectionObserver=new IntersectionObserver(t=>this._handleIntersection(t)),this._intersectionObserver.observe(this.canvas),this._resizeObserver=new ResizeObserver(t=>this._handleResize(t));try{this._resizeObserver.observe(this.canvas,{box:"device-pixel-content-box"})}catch{this._resizeObserver.observe(this.canvas,{box:"content-box"})}setTimeout(()=>this._observeDevicePixelRatio(),0),this.props.trackPosition&&this._trackPosition()}}destroy(){this.destroyed=!0}setProps(e){return"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1,this._updateDrawingBufferSize()),this}getCSSSize(){return[this.cssWidth,this.cssHeight]}getPosition(){return this._position}getDevicePixelSize(){return[this.devicePixelWidth,this.devicePixelHeight]}getDrawingBufferSize(){return[this.drawingBufferWidth,this.drawingBufferHeight]}getMaxDrawingBufferSize(){let e=this.device.limits.maxTextureDimension2D;return[e,e]}setDrawingBufferSize(e,t){this.canvas.width=e,this.canvas.height=t,this.drawingBufferWidth=e,this.drawingBufferHeight=t}getDevicePixelRatio(){return typeof window<"u"&&window.devicePixelRatio||1}cssToDevicePixels(e,t=!0){let r=this.cssToDeviceRatio(),[n,s]=this.getDrawingBufferSize();return Mr(e,r,n,s,t)}getPixelSize(){return this.getDevicePixelSize()}getAspect(){let[e,t]=this.getDevicePixelSize();return e/t}cssToDeviceRatio(){try{let[e]=this.getDrawingBufferSize(),[t]=this.getCSSSize();return t?e/t:1}catch{return 1}}resize(e){this.setDrawingBufferSize(e.width,e.height)}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}_handleIntersection(e){let t=e.find(n=>n.target===this.canvas);if(!t)return;let r=t.isIntersecting;this.isVisible!==r&&(this.isVisible=r,this.device.props.onVisibilityChange(this))}_handleResize(e){let t=e.find(m=>m.target===this.canvas);if(!t)return;this.cssWidth=t.contentBoxSize[0].inlineSize,this.cssHeight=t.contentBoxSize[0].blockSize;let r=this.getDevicePixelSize(),n=t.devicePixelContentBoxSize?.[0].inlineSize||t.contentBoxSize[0].inlineSize*devicePixelRatio,s=t.devicePixelContentBoxSize?.[0].blockSize||t.contentBoxSize[0].blockSize*devicePixelRatio,[a,h]=this.getMaxDrawingBufferSize();this.devicePixelWidth=Math.max(1,Math.min(n,a)),this.devicePixelHeight=Math.max(1,Math.min(s,h)),this._updateDrawingBufferSize(),this.device.props.onResize(this,{oldPixelSize:r})}_updateDrawingBufferSize(){if(this.props.autoResize){if(typeof this.props.useDevicePixels=="number"){let e=this.props.useDevicePixels;this.setDrawingBufferSize(this.cssWidth*e,this.cssHeight*e)}else this.props.useDevicePixels?this.setDrawingBufferSize(this.devicePixelWidth,this.devicePixelHeight):this.setDrawingBufferSize(this.cssWidth,this.cssHeight);this._updateDevice()}this._initializedResolvers.resolve(),this.isInitialized=!0,this.updatePosition()}_observeDevicePixelRatio(){let e=this.devicePixelRatio;this.devicePixelRatio=window.devicePixelRatio,this.updatePosition(),this.device.props.onDevicePixelRatioChange(this,{oldRatio:e}),matchMedia(`(resolution: ${this.devicePixelRatio}dppx)`).addEventListener("change",()=>this._observeDevicePixelRatio(),{once:!0})}_trackPosition(e=100){let t=setInterval(()=>{this.destroyed?clearInterval(t):this.updatePosition()},e)}updatePosition(){let e=this.htmlCanvas?.getBoundingClientRect();if(e){let t=[e.left,e.top];if(this._position??=t,t[0]!==this._position[0]||t[1]!==this._position[1]){let n=this._position;this._position=t,this.device.props.onPositionChange?.(this,{oldPosition:n})}}}},G=H;f(G,"defaultProps",{id:void 0,canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb",trackPosition:!1});function Dr(i){if(typeof i=="string"){let e=document.getElementById(i);if(!e)throw new Error(`${i} is not an HTML element`);return e}return i||document.body}function Ir(i){let e=document.getElementById(i);if(!G.isHTMLCanvas(e))throw new Error("Object is not a canvas element");return e}function Rr(i){let{width:e,height:t}=i,r=document.createElement("canvas");r.id=M("lumagl-auto-created-canvas"),r.width=e||1,r.height=t||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(t)?`${t}px`:"100%",i?.visible||(r.style.visibility="hidden");let n=Dr(i?.container||null);return n.insertBefore(r,n.firstChild),r}function Mr(i,e,t,r,n){let s=i,a=Ot(s[0],e,t),h=Ht(s[1],e,r,n),m=Ot(s[0]+1,e,t),x=m===t-1?m:m-1;m=Ht(s[1]+1,e,r,n);let v;return n?(m=m===0?m:m+1,v=h,h=m):v=m===r-1?m:m-1,{x:a,y:h,width:Math.max(x-a+1,1),height:Math.max(v-h+1,1)}}function Ot(i,e,t){return Math.min(Math.round(i*e),t-1)}function Ht(i,e,t,r){return r?Math.max(0,t-1-Math.round(i*e)):Math.min(Math.round(i*e),t-1)}o();o();var _e=class extends p{get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=_e.normalizeProps(e,t),super(e,t,_e.defaultProps)}static normalizeProps(e,t){return t}},_=_e;f(_,"defaultProps",{...p.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});var Fr={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"},I=class extends p{dimension;baseDimension;format;width;height;depth;mipLevels;updateTimestamp;get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}constructor(e,t){if(t=I.normalizeProps(e,t),super(e,t,I.defaultProps),this.dimension=this.props.dimension,this.baseDimension=Fr[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,this.props.width===void 0||this.props.height===void 0)if(e.isExternalImage(t.data)){let r=e.getExternalImageSize(t.data);this.width=r?.width||1,this.height=r?.height||1}else this.width=1,this.height=1,(this.props.width===void 0||this.props.height===void 0)&&d.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=e.incrementTimestamp()}setSampler(e){this.sampler=e instanceof _?e:this.device.createSampler(e)}clone(e){return this.device.createTexture({...this.props,...e})}static normalizeProps(e,t){let r={...t},{width:n,height:s}=r;return typeof n=="number"&&(r.width=Math.max(1,Math.ceil(n))),typeof s=="number"&&(r.height=Math.max(1,Math.ceil(s))),r}_initializeData(e){this.device.isExternalImage(e)?this.copyExternalImage({image:e,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):e&&this.copyImageData({data:e,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(e){let{width:t,height:r,depth:n}=this,s={...I.defaultCopyDataOptions,width:t,height:r,depth:n,...e},a=this.device.getTextureFormatInfo(this.format);if(!e.bytesPerRow&&!a.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return s.bytesPerRow=e.bytesPerRow||t*(a.bytesPerPixel||4),s.rowsPerImage=e.rowsPerImage||r,s}_normalizeCopyExternalImageOptions(e){let t=this.device.getExternalImageSize(e.image),r={...I.defaultCopyExternalImageOptions,...t,...e};return r.width=Math.min(r.width,this.width-r.x),r.height=Math.min(r.height,this.height-r.y),r}},y=I;f(y,"SAMPLE",4),f(y,"STORAGE",8),f(y,"RENDER",16),f(y,"COPY_SRC",1),f(y,"COPY_DST",2),f(y,"TEXTURE",4),f(y,"RENDER_ATTACHMENT",16),f(y,"defaultProps",{...p.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:I.TEXTURE|I.RENDER_ATTACHMENT|I.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0}),f(y,"defaultCopyDataOptions",{data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"}),f(y,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});o();var ct=class extends p{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,ct.defaultProps)}},N=ct;f(N,"defaultProps",{...p.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});o();var ut=class extends p{get[Symbol.toStringTag](){return"ExternalTexture"}constructor(e,t){super(e,t,ut.defaultProps)}},V=ut;f(V,"defaultProps",{...p.defaultProps,source:void 0,colorSpace:"srgb"});o();o();function Nt(i,e,t){let r="",n=e.split(/\r?\n/),s=i.slice().sort((a,h)=>a.lineNum-h.lineNum);switch(t?.showSourceCode||"no"){case"all":let a=0;for(let h=1;h<=n.length;h++)for(r+=Vt(n[h-1],h,t);s.length>a&&s[a].lineNum===h;){let m=s[a++];r+=lt(m,n,m.lineNum,{...t,inlineSource:!1})}for(;s.length>a;){let h=s[a++];r+=lt(h,[],0,{...t,inlineSource:!1})}return r;case"issues":case"no":for(let h of i)r+=lt(h,n,h.lineNum,{inlineSource:t?.showSourceCode!=="no"});return r}}function lt(i,e,t,r){if(r?.inlineSource){let s=$r(e,t),a=i.linePos>0?`${" ".repeat(i.linePos+5)}^^^
`:"";return`
${s}${a}${i.type.toUpperCase()}: ${i.message}

`}let n=i.type==="error"?"red":"#8B4000";return r?.html?`<div class='luma-compiler-log-error' style="color:${n};"><b> ${i.type.toUpperCase()}: ${i.message}</b></div>`:`${i.type.toUpperCase()}: ${i.message}`}function $r(i,e,t){let r="";for(let n=e-2;n<=e;n++){let s=i[n-1];s!==void 0&&(r+=Vt(s,e,t))}return r}function Vt(i,e,t){let r=t?.html?zr(i):i;return`${Gr(String(e),4)}: ${r}${t?.html?"<br/>":`
`}`}function Gr(i,e){let t="";for(let r=i.length;r<e;++r)t+=" ";return t+i}function zr(i){return i.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}var ht=class extends p{get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,t){t={...t,debugShaders:t.debugShaders||e.props.debugShaders||"errors"},super(e,{id:Wr(t),...t},ht.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){let e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break;case"warnings":case"always":break}let t=await this.getCompilationInfo();e==="warnings"&&t?.length===0||this._displayShaderLog(t,this.id)}_displayShaderLog(e,t){if(typeof document>"u"||!document?.createElement)return;let r=t,n=`${this.stage} shader "${r}"`,s=Nt(e,this.source,{showSourceCode:"all",html:!0}),a=this.getTranslatedSource();a&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${a}</pre></code>`);let h=document.createElement("Button");h.innerHTML=`
<h1>Compilation error in ${n}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,h.style.top="10px",h.style.left="10px",h.style.position="absolute",h.style.zIndex="9999",h.style.width="100%",h.style.textAlign="left",document.body.appendChild(h),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),h.onclick=()=>{let x=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(x)}}},Y=ht;f(Y,"defaultProps",{...p.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});function Wr(i){return Ur(i.source)||i.id||M(`unnamed ${i.stage}-shader`)}function Ur(i,e="unnamed"){let r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(i);return r?r[1]:e}o();var dt=class extends p{get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,t={}){super(e,t,dt.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){let t=this.colorAttachments.map(n=>n.texture.clone(e)),r=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:t,depthStencilAttachment:r})}resize(e){let t=!e;if(e){let[r,n]=Array.isArray(e)?e:[e.width,e.height];t=t||n!==this.height||r!==this.width,this.width=r,this.height=n}t&&(d.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((t,r)=>{if(typeof t=="string"){let n=this.createColorTexture(t,r);return this.attachResource(n),n.view}return t instanceof y?t.view:t});let e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){let t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else e instanceof y?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,t){return this.device.createTexture({id:`${this.id}-color-attachment-${t}`,usage:y.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:y.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}resizeAttachments(e,t){for(let r=0;r<this.colorAttachments.length;++r)if(this.colorAttachments[r]){let n=this.colorAttachments[r].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[r]),this.colorAttachments[r]=n.view,this.attachResource(n.view)}if(this.depthStencilAttachment){let r=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=r.view,this.attachResource(r)}this.updateAttachments()}},j=dt;f(j,"defaultProps",{...p.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});o();var ft=class extends p{get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,t){super(e,t,ft.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}},X=ft;f(X,"defaultProps",{...p.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}});o();var z=class extends p{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=z.normalizeProps(e,t),super(e,t,z.defaultProps)}static normalizeProps(e,t){return t}},C=z;f(C,"defaultClearColor",[0,0,0,1]),f(C,"defaultClearDepth",1),f(C,"defaultClearStencil",0),f(C,"defaultProps",{...p.defaultProps,framebuffer:null,parameters:void 0,clearColor:z.defaultClearColor,clearColors:void 0,clearDepth:z.defaultClearDepth,clearStencil:z.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});o();var pt=class extends p{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,t){super(e,t,pt.defaultProps),this.shaderLayout=t.shaderLayout}},Q=pt;f(Q,"defaultProps",{...p.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});o();var mt=class extends p{constructor(e,t){super(e,t,mt.defaultProps)}get[Symbol.toStringTag](){return"ComputePass"}},q=mt;f(q,"defaultProps",{...p.defaultProps,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});o();var gt=class extends p{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,gt.defaultProps)}},J=gt;f(J,"defaultProps",{...p.defaultProps,measureExecutionTime:void 0});o();var bt=class extends p{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,bt.defaultProps)}},K=bt;f(K,"defaultProps",{...p.defaultProps});o();o();o();function Yt(i){return Hr[i]}function jt(i){let[e,t]=Or[i],r=e==="i32"||e==="u32",n=e!=="u32",s=kr[e]*t;return{primitiveType:e,components:t,byteLength:s,integer:r,signed:n}}var kr={f32:4,f16:2,i32:4,u32:4},Or={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},Hr={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}},Nr={vec2i:"vec2<i32>",vec3i:"vec3<i32>",vec4i:"vec4<i32>",vec2u:"vec2<u32>",vec3u:"vec3<u32>",vec4u:"vec4<u32>",vec2f:"vec2<f32>",vec3f:"vec3<f32>",vec4f:"vec4<f32>",vec2h:"vec2<f16>",vec3h:"vec3<f16>",vec4h:"vec4<f16>"},yo={...Nr,mat2x2f:"mat2x2<f32>",mat2x3f:"mat2x3<f32>",mat2x4f:"mat2x4<f32>",mat3x2f:"mat3x2<f32>",mat3x3f:"mat3x3<f32>",mat3x4f:"mat3x4<f32>",mat4x2f:"mat4x2<f32>",mat4x3f:"mat4x3<f32>",mat4x4f:"mat4x4<f32>",mat2x2i:"mat2x2<i32>",mat2x3i:"mat2x3<i32>",mat2x4i:"mat2x4<i32>",mat3x2i:"mat3x2<i32>",mat3x3i:"mat3x3<i32>",mat3x4i:"mat3x4<i32>",mat4x2i:"mat4x2<i32>",mat4x3i:"mat4x3<i32>",mat4x4i:"mat4x4<i32>",mat2x2u:"mat2x2<u32>",mat2x3u:"mat2x3<u32>",mat2x4u:"mat2x4<u32>",mat3x2u:"mat3x2<u32>",mat3x3u:"mat3x3<u32>",mat3x4u:"mat3x4<u32>",mat4x2u:"mat4x2<u32>",mat4x3u:"mat4x3<u32>",mat4x4u:"mat4x4<u32>",mat2x2h:"mat2x2<f16>",mat2x3h:"mat2x3<f16>",mat2x4h:"mat2x4<f16>",mat3x2h:"mat3x2<f16>",mat3x3h:"mat3x3<f16>",mat3x4h:"mat3x4<f16>",mat4x2h:"mat4x2<f16>",mat4x3h:"mat4x3<f16>",mat4x4h:"mat4x4<f16>"};function Xt(i,e){let t={};for(let r of i.attributes){let n=Vr(i,e,r.name);n&&(t[r.name]=n)}return t}function Qt(i,e,t=16){let r=Xt(i,e),n=new Array(t).fill(null);for(let s of Object.values(r))n[s.location]=s;return n}function Vr(i,e,t){let r=Yr(i,t),n=jr(e,t);if(!r)return null;let s=jt(r.type),a=Ft(s),h=n?.vertexFormat||a,m=P(h);return{attributeName:n?.attributeName||r.name,bufferName:n?.bufferName||r.name,location:r.location,shaderType:r.type,primitiveType:s.primitiveType,shaderComponents:s.components,vertexFormat:h,bufferDataType:m.type,bufferComponents:m.components,normalized:m.normalized,integer:s.integer,stepMode:n?.stepMode||r.stepMode||"vertex",byteOffset:n?.byteOffset||0,byteStride:n?.byteStride||0}}function Yr(i,e){let t=i.attributes.find(r=>r.name===e);return t||d.warn(`shader layout attribute "${e}" not present in shader`),t||null}function jr(i,e){Xr(i);let t=Qr(i,e);return t||(t=qr(i,e),t)?t:(d.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function Xr(i){for(let e of i)(e.attributes&&e.format||!e.attributes&&!e.format)&&d.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function Qr(i,e){for(let t of i)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function qr(i,e){for(let t of i){let r=t.byteStride;if(typeof t.byteStride!="number")for(let s of t.attributes||[]){let a=P(s.format);r+=a.byteLength}let n=t.attributes?.find(s=>s.attribute===e);if(n)return{attributeName:n.attribute,bufferName:t.name,stepMode:t.stepMode,vertexFormat:n.format,byteOffset:n.byteOffset,byteStride:r}}return null}var yt=class extends p{get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,t){super(e,t,yt.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=Qt(t.shaderLayout,t.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(e,t){this.device.reportError(new Error("constant attributes not supported"),this)()}},Z=yt;f(Z,"defaultProps",{...p.defaultProps,shaderLayout:void 0,bufferLayout:[]});o();var xt=class extends p{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,xt.defaultProps)}},ee=xt;f(ee,"defaultProps",{...p.defaultProps,type:void 0,count:void 0});o();var vt=class extends p{get[Symbol.toStringTag](){return"PipelineLayout"}constructor(e,t){super(e,t,vt.defaultProps)}},te=vt;f(te,"defaultProps",{...p.defaultProps,shaderLayout:{attributes:[],bindings:[]}});o();o();var Ce;function qt(i){return(!Ce||Ce.byteLength<i)&&(Ce=new ArrayBuffer(i)),Ce}o();function Jr(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function re(i){return Array.isArray(i)?i.length===0||typeof i[0]=="number":Jr(i)}var Kr=1024,Be=class{layout={};byteLength;constructor(e,t={}){let r=0;for(let[s,a]of Object.entries(e)){let h=Yt(a),{type:m,components:x}=h,v=x*(t?.[s]??1);r=Rt(r,v);let T=r;r+=v,this.layout[s]={type:m,size:v,offset:T}}r+=(4-r%4)%4;let n=r*4;this.byteLength=Math.max(n,Kr)}getData(e){let t=qt(this.byteLength),r={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(let[n,s]of Object.entries(e)){let a=this.layout[n];if(!a){d.warn(`Supplied uniform value ${n} not present in uniform block layout`)();continue}let{type:h,size:m,offset:x}=a,v=r[h];if(m===1){if(typeof s!="number"&&typeof s!="boolean"){d.warn(`Supplied value for single component uniform ${n} is not a number: ${s}`)();continue}v[x]=Number(s)}else{if(!re(s)){d.warn(`Supplied value for multi component / array uniform ${n} is not a numeric array: ${s}`)();continue}v.set(s,x)}}return new Uint8Array(t,0,this.byteLength)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}};o();o();function Jt(i,e,t=16){if(i!==e)return!1;let r=i,n=e;if(!re(r))return!1;if(re(n)&&r.length===n.length){for(let s=0;s<r.length;++s)if(n[s]!==r[s])return!1}return!0}function Kt(i){return re(i)?i.slice():i}var Le=class{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){let t=e?.shaderLayout.bindings?.find(n=>n.type==="uniform"&&n.name===e?.name);if(!t)throw new Error(e?.name);let r=t;for(let n of r.uniforms||[])this.bindingLayout[n.name]=n}}setUniforms(e){for(let[t,r]of Object.entries(e))this._setUniform(t,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){Jt(this.uniforms[e],t)||(this.uniforms[e]=Kt(t),this.modifiedUniforms[e]=!0,this.modified=!0)}};o();var wt=class{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(let[t,r]of Object.entries(e)){let n=t,s=new Be(r.uniformTypes??{},r.uniformSizes??{});this.uniformBufferLayouts.set(n,s);let a=new Le({name:t});a.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(n,a)}}destroy(){for(let e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(let[t,r]of Object.entries(e))this.uniformBlocks.get(t)?.setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){let t=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(t)}createUniformBuffer(e,t,r){r&&this.setUniforms(r);let n=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:g.UNIFORM|g.COPY_DST,byteLength:n}),a=this.getUniformBufferData(t);return s.write(a),s}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){let r=this.getUniformBufferByteLength(t),n=e.createBuffer({usage:g.UNIFORM|g.COPY_DST,byteLength:r});this.uniformBuffers.set(t,n)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(let t of this.uniformBlocks.keys()){let r=this.updateUniformBuffer(t);e||=r}return e&&d.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){let t=this.uniformBlocks.get(e),r=this.uniformBuffers.get(e),n=!1;if(r&&t?.needsRedraw){n||=t.needsRedraw;let s=this.getUniformBufferData(e);r=this.uniformBuffers.get(e),r?.write(s);let a=this.uniformBlocks.get(e)?.getAllUniforms();d.log(4,`Writing to uniform buffer ${String(e)}`,s,a)()}return n}};o();var ie=class extends g{device;handle;byteLength;constructor(e,t){super(e,t),this.device=e,this.byteLength=t.byteLength||t.data?.byteLength||0;let r=!!(this.props.onMapped||t.data),n=Math.ceil(this.byteLength/4)*4;if(this.device.pushErrorScope("out-of-memory"),this.device.pushErrorScope("validation"),this.handle=this.props.handle||this.device.handle.createBuffer({label:this.props.id,usage:this.props.usage||GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:r,size:n}),this.device.popErrorScope(s=>{this.device.reportError(new Error(`${this} creation failed ${s.message}`),this)(),this.device.debug()}),this.device.popErrorScope(s=>{this.device.reportError(new Error(`${this} out of memory: ${s.message}`),this)(),this.device.debug()}),this.device.pushErrorScope("validation"),t.data||t.onMapped)try{let s=this.handle.getMappedRange();if(t.data){let a=t.data;new a.constructor(s).set(a)}else t.onMapped?.(s,"mapped")}finally{this.handle.unmap()}this.device.popErrorScope(s=>{this.device.reportError(new Error(`${this} creation failed ${s.message}`),this)(),this.device.debug()})}destroy(){this.handle?.destroy(),this.handle=null}write(e,t=0){let r=ArrayBuffer.isView(e)?e.buffer:e,n=ArrayBuffer.isView(e)?e.byteOffset:0;this.device.pushErrorScope("validation"),this.device.handle.queue.writeBuffer(this.handle,t,r,n,e.byteLength),this.device.popErrorScope(s=>{this.device.reportError(new Error(`${this}.write() ${s.message}`),this)(),this.device.debug()})}async mapAndWriteAsync(e,t=0,r=this.byteLength-t){let s=(this.usage&g.MAP_WRITE)!==0?null:this._getMappableBuffer(g.MAP_WRITE|g.COPY_SRC,0,this.byteLength),a=s||this;this.device.pushErrorScope("validation");try{await this.device.handle.queue.onSubmittedWorkDone(),await a.handle.mapAsync(GPUMapMode.WRITE,t,r);let h=a.handle.getMappedRange(t,r);await e(h,"mapped"),a.handle.unmap(),s&&this._copyBuffer(s,t,r)}finally{this.device.popErrorScope(h=>{this.device.reportError(new Error(`${this}.mapAndWriteAsync() ${h.message}`),this)(),this.device.debug()}),s?.destroy()}}async readAsync(e=0,t=this.byteLength-e){return this.mapAndReadAsync(r=>new Uint8Array(r.slice(0)),e,t)}async mapAndReadAsync(e,t=0,r=this.byteLength-t){if(t%8!==0||r%4!==0)throw new Error("byteOffset must be multiple of 8 and byteLength multiple of 4");if(t+r>this.handle.size)throw new Error("Mapping range exceeds buffer size");let s=(this.usage&g.MAP_READ)!==0?null:this._getMappableBuffer(g.MAP_READ|g.COPY_DST,0,this.byteLength),a=s||this;this.device.pushErrorScope("validation");try{await this.device.handle.queue.onSubmittedWorkDone(),s&&s._copyBuffer(this),await a.handle.mapAsync(GPUMapMode.READ,t,r);let h=a.handle.getMappedRange(t,r),m=await e(h,"mapped");return a.handle.unmap(),m}finally{this.device.popErrorScope(h=>{this.device.reportError(new Error(`${this}.mapAndReadAsync() ${h.message}`),this)(),this.device.debug()}),s?.destroy()}}readSyncWebGL(e,t){throw new Error("Not implemented")}_getMappableBuffer(e,t,r){return d.warn(`${this} is not readable, creating a temporary Buffer`),new ie(this.device,{usage:e,byteLength:r})}_copyBuffer(e,t=0,r=this.byteLength){this.device.pushErrorScope("validation");let n=this.device.handle.createCommandEncoder();n.copyBufferToBuffer(e.handle,t,this.handle,t,r),this.device.handle.queue.submit([n.finish()]),this.device.popErrorScope(s=>{this.device.reportError(new Error(`${this}._getReadableBuffer() ${s.message}`),this)(),this.device.debug()})}};o();o();function ne(i){if(i.includes("webgl"))throw new Error("webgl-only format");return i}o();var B=class extends _{device;handle;constructor(e,t){super(e,t),this.device=e;let r={...this.props,mipmapFilter:void 0};t.type!=="comparison-sampler"&&delete r.compare,t.mipmapFilter&&t.mipmapFilter!=="none"&&(r.mipmapFilter=t.mipmapFilter),this.handle=t.handle||this.device.handle.createSampler(r),this.handle.label=this.props.id}destroy(){this.handle=null}};o();var fe=class extends N{device;handle;texture;constructor(e,t){super(e,t),this.device=e,this.texture=t.texture,this.device.pushErrorScope("validation"),this.handle=this.texture.handle.createView({format:this.props.format||this.texture.format,dimension:this.props.dimension||this.texture.dimension,aspect:this.props.aspect,baseMipLevel:this.props.baseMipLevel,mipLevelCount:this.props.mipLevelCount,baseArrayLayer:this.props.baseArrayLayer,arrayLayerCount:this.props.arrayLayerCount}),this.device.popErrorScope(r=>{this.device.reportError(new Error(`TextureView constructor: ${r.message}`),this)(),this.device.debug()}),this.handle.label=this.props.id}destroy(){this.handle=null}};var De=class extends y{device;handle;sampler;view;constructor(e,t){super(e,t),this.device=e,this.dimension==="cube"&&(this.depth=6),this.device.pushErrorScope("out-of-memory"),this.device.pushErrorScope("validation"),this.handle=this.props.handle||this.device.handle.createTexture({label:this.id,size:{width:this.width,height:this.height,depthOrArrayLayers:this.depth},usage:this.props.usage||y.TEXTURE|y.COPY_DST,dimension:this.baseDimension,format:ne(this.format),mipLevelCount:this.mipLevels,sampleCount:this.props.samples}),this.device.popErrorScope(r=>{this.device.reportError(new Error(`${this} constructor: ${r.message}`),this)(),this.device.debug()}),this.device.popErrorScope(r=>{this.device.reportError(new Error(`${this} out of memory: ${r.message}`),this)(),this.device.debug()}),this.props.handle&&(this.handle.label||=this.id,this.width=this.handle.width,this.height=this.handle.height),this.sampler=t.sampler instanceof B?t.sampler:new B(this.device,t.sampler||{}),this.view=new fe(this.device,{...this.props,texture:this,mipLevelCount:this.mipLevels,arrayLayerCount:this.dimension!=="3d"?this.depth:1}),this._initializeData(t.data)}destroy(){this.handle?.destroy(),this.handle=null}createView(e){return new fe(this.device,{...e,texture:this})}copyImageData(e){let{width:t,height:r,depth:n}=this,s=this._normalizeCopyImageDataOptions(e);this.device.pushErrorScope("validation"),this.device.handle.queue.writeTexture({texture:this.handle,mipLevel:s.mipLevel,aspect:s.aspect,origin:[s.x,s.y,s.z]},s.data,{offset:s.byteOffset,bytesPerRow:s.bytesPerRow,rowsPerImage:s.rowsPerImage},[t,r,n]),this.device.popErrorScope(a=>{this.device.reportError(new Error(`copyImageData: ${a.message}`),this)(),this.device.debug()})}copyExternalImage(e){let t=this._normalizeCopyExternalImageOptions(e);return this.device.pushErrorScope("validation"),this.device.handle.queue.copyExternalImageToTexture({source:t.image,origin:[t.sourceX,t.sourceY],flipY:t.flipY},{texture:this.handle,origin:[t.x,t.y,0],mipLevel:t.mipLevel,aspect:t.aspect,colorSpace:t.colorSpace,premultipliedAlpha:t.premultipliedAlpha},[t.width,t.height,1]),this.device.popErrorScope(r=>{this.device.reportError(new Error(`copyExternalImage: ${r.message}`),this)(),this.device.debug()}),{width:t.width,height:t.height}}generateMipmapsWebGL(){d.warn(`${this}: generateMipmaps not supported in WebGPU`)()}};o();var Ie=class extends V{device;handle;sampler;constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.handle.importExternalTexture({source:t.source,colorSpace:t.colorSpace}),this.sampler=null}destroy(){this.handle=null}setSampler(e){return this.sampler=e instanceof B?e:new B(this.device,e),this}};o();var Re=class extends Y{device;handle;constructor(e,t){super(e,t),this.device=e;let r=t.source.includes("#version");if(this.props.language==="glsl"||r)throw new Error("GLSL shaders are not supported in WebGPU");this.device.pushErrorScope("validation"),this.handle=this.props.handle||this.device.handle.createShaderModule({code:t.source}),this.device.popErrorScope(n=>{this.device.reportError(new Error(`${this} creation failed:
"${n.message}"`),this,this.props.source)(),this.device.debug()}),this.handle.label=this.props.id,this._checkCompilationError()}get asyncCompilationStatus(){return this.getCompilationInfo().then(()=>this.compilationStatus)}async _checkCompilationError(){let e=await this.getCompilationInfo(),t=!!e.find(r=>r.type==="error");this.compilationStatus=t?"error":"success",this.debugShader(),this.compilationStatus==="error"&&(this.device.reportError(new Error("Shader compilation error"),this,e)(),this.device.debug())}destroy(){this.handle=null}async getCompilationInfo(){return(await this.handle.getCompilationInfo()).messages}};o();o();function L(i){return i.depthStencil=i.depthStencil||{format:"depth24plus",stencilFront:{},stencilBack:{},depthWriteEnabled:!1,depthCompare:"less-equal"},i.depthStencil}function Me(i){return L(i).stencilFront}function Fe(i){return L(i).stencilBack}var Zr={cullMode:(i,e,t)=>{t.primitive=t.primitive||{},t.primitive.cullMode=e},frontFace:(i,e,t)=>{t.primitive=t.primitive||{},t.primitive.frontFace=e},depthWriteEnabled:(i,e,t)=>{if(e){let r=L(t);r.depthWriteEnabled=e}},depthCompare:(i,e,t)=>{let r=L(t);r.depthCompare=e},depthFormat:(i,e,t)=>{let r=L(t);r.format=e},depthBias:(i,e,t)=>{let r=L(t);r.depthBias=e},depthBiasSlopeScale:(i,e,t)=>{let r=L(t);r.depthBiasSlopeScale=e},depthBiasClamp:(i,e,t)=>{let r=L(t);r.depthBiasClamp=e},stencilReadMask:(i,e,t)=>{let r=L(t);r.stencilReadMask=e},stencilWriteMask:(i,e,t)=>{let r=L(t);r.stencilWriteMask=e},stencilCompare:(i,e,t)=>{let r=Me(t),n=Fe(t);r.compare=e,n.compare=e},stencilPassOperation:(i,e,t)=>{let r=Me(t),n=Fe(t);r.passOp=e,n.passOp=e},stencilFailOperation:(i,e,t)=>{let r=Me(t),n=Fe(t);r.failOp=e,n.failOp=e},stencilDepthFailOperation:(i,e,t)=>{let r=Me(t),n=Fe(t);r.depthFailOp=e,n.depthFailOp=e},sampleCount:(i,e,t)=>{t.multisample=t.multisample||{},t.multisample.count=e},sampleMask:(i,e,t)=>{t.multisample=t.multisample||{},t.multisample.mask=e},sampleAlphaToCoverageEnabled:(i,e,t)=>{t.multisample=t.multisample||{},t.multisample.alphaToCoverageEnabled=e},colorMask:(i,e,t)=>{let r=er(t,0);r.writeMask=e},blend:(i,e,t)=>{e&&W(t,0)},blendColorOperation:(i,e,t)=>{let r=W(t,0);r.color=r.color||{},r.color.operation=e},blendColorSrcFactor:(i,e,t)=>{let r=W(t,0);r.color=r.color||{},r.color.srcFactor=e},blendColorDstFactor:(i,e,t)=>{let r=W(t,0);r.color.dstFactor=e},blendAlphaOperation:(i,e,t)=>{let r=W(t,0);r.alpha=r.alpha||{},r.alpha.operation=e},blendAlphaSrcFactor:(i,e,t)=>{let r=W(t,0);r.alpha=r.alpha||{},r.alpha.srcFactor=e},blendAlphaDstFactor:(i,e,t)=>{let r=W(t,0);r.alpha=r.alpha||{},r.alpha.dstFactor=e},unclippedDepth:E,provokingVertex:E,polygonMode:E,polygonOffsetLine:E,clipDistance0:E,clipDistance1:E,clipDistance2:E,clipDistance3:E,clipDistance4:E,clipDistance5:E,clipDistance6:E,clipDistance7:E};function E(i,e,t){d.warn(`${i} parameter not supported in WebGPU`)()}var ei={primitive:{cullMode:"back",topology:"triangle-list"},vertex:{module:void 0,entryPoint:"main"},fragment:{module:void 0,entryPoint:"main",targets:[]},layout:"auto"};function Zt(i,e={}){Object.assign(i,{...ei,...i}),ti(i,e)}function ti(i,e){for(let[t,r]of Object.entries(e)){let n=Zr[t];n?n(t,r,i):d.error(`Illegal parameter ${t} in WebGPU`)()}}function er(i,e){return i.fragment.targets=i.fragment?.targets||[],Array.isArray(i.fragment?.targets)||d.warn("parameters: no targets array")(),i.fragment?.targets?.length===0&&i.fragment.targets?.push({}),i.fragment?.targets?.[0]}function W(i,e){let t=er(i,e);return t.blend=t.blend||{color:{},alpha:{}},t.blend}o();function $e(i,e,t,r){let n=ri(r,t);i.pushErrorScope("validation");let s=i.createBindGroup({layout:e,entries:n});return i.popErrorScope().then(a=>{a&&d.error(`bindGroup creation: ${a.message}`,s)()}),s}function tr(i,e,t){let r=i.bindings.find(n=>n.name===e||`${n.name.toLocaleLowerCase()}uniforms`===e.toLocaleLowerCase());return!r&&!t?.ignoreWarnings&&d.warn(`Binding ${e} not set: Not found in shader layout.`)(),r||null}function ri(i,e){let t=[];for(let[r,n]of Object.entries(i)){let s=tr(e,r);if(s){let a=rr(n,s.location);a&&t.push(a)}if(n instanceof y&&(s=tr(e,`${r}Sampler`,{ignoreWarnings:!0}),s)){let a=rr(n,s.location,{sampler:!0});a&&t.push(a)}}return t}function rr(i,e,t){return i instanceof g?{binding:e,resource:{buffer:i.handle}}:i instanceof _?{binding:e,resource:i.handle}:i instanceof y?t?.sampler?{binding:e,resource:i.sampler.handle}:{binding:e,resource:i.view.handle}:(d.warn(`invalid binding ${name}`,i),null)}o();function St(i){if(i.endsWith("-webgl"))throw new Error(`WebGPU does not support vertex format ${i}`);return i}function nr(i,e){let t=[],r=new Set;for(let n of e){let s=[],a="vertex",h=0,m=n.format;if(n.attributes)for(let x of n.attributes){let v=x.attribute,T=ir(i,v,r),Ye=T?.location;m=x.format||n.format,a=T?.stepMode||(T?.name.startsWith("instance")?"instance":"vertex"),s.push({format:St(m),offset:x.byteOffset,shaderLocation:Ye}),h+=P(m).byteLength}else{let x=ir(i,n.name,r);if(!x)continue;h=P(m).byteLength,a=x.stepMode||(x.name.startsWith("instance")?"instance":"vertex"),s.push({format:St(m),offset:0,shaderLocation:x.location})}t.push({arrayStride:n.byteStride||h,stepMode:a,attributes:s})}for(let n of i.attributes)r.has(n.name)||t.push({arrayStride:P("float32x3").byteLength,stepMode:n.stepMode||(n.name.startsWith("instance")?"instance":"vertex"),attributes:[{format:St("float32x3"),offset:0,shaderLocation:n.location}]});return t.sort((n,s)=>{let a=Math.min(...Array.from(n.attributes,m=>m.shaderLocation)),h=Math.min(...Array.from(s.attributes,m=>m.shaderLocation));return a-h}),t}function ir(i,e,t){let r=i.attributes.find(n=>n.name===e);if(!r)return d.warn(`Supplied attribute not present in shader layout: ${e}`)(),null;if(t){if(t.has(e))throw new Error(`Found multiple entries for attribute: ${e}`);t.add(e)}return r}var Ge=class extends X{device;handle;vs;fs=null;_bindings;_bindGroupLayout=null;_bindGroup=null;get[Symbol.toStringTag](){return"WebGPURenderPipeline"}constructor(e,t){if(super(e,t),this.device=e,this.handle=this.props.handle,!this.handle){let r=this._getRenderPipelineDescriptor();d.groupCollapsed(1,`new WebGPURenderPipeline(${this.id})`)(),d.probe(1,JSON.stringify(r,null,2))(),d.groupEnd(1)(),this.device.pushErrorScope("validation"),this.handle=this.device.handle.createRenderPipeline(r),this.device.popErrorScope(n=>{this.device.reportError(new Error(`${this} creation failed:
"${n.message}"`),this)(),this.device.debug()})}this.handle.label=this.props.id,this.vs=t.vs,this.fs=t.fs,this._bindings={...this.props.bindings}}destroy(){this.handle=null}setBindings(e){for(let[t,r]of Object.entries(e))this._bindings[t]!==r&&(this._bindGroup=null);Object.assign(this._bindings,e)}draw(e){let t=e.renderPass;this.device.pushErrorScope("validation"),t.handle.setPipeline(this.handle),this.device.popErrorScope(n=>{this.device.reportError(new Error(`${this} setPipeline failed:
"${n.message}"`),this)(),this.device.debug()});let r=this._getBindGroup();return r&&t.handle.setBindGroup(0,r),e.vertexArray.bindBeforeRender(e.renderPass),e.indexCount?t.handle.drawIndexed(e.indexCount,e.instanceCount,e.firstIndex,e.baseVertex,e.firstInstance):t.handle.draw(e.vertexCount||0,e.instanceCount||1,e.firstInstance),e.vertexArray.unbindAfterRender(e.renderPass),!0}_getBindGroup(){return this.shaderLayout.bindings.length===0?null:(this._bindGroupLayout=this._bindGroupLayout||this.handle.getBindGroupLayout(0),this._bindGroup=this._bindGroup||$e(this.device.handle,this._bindGroupLayout,this.shaderLayout,this._bindings),this._bindGroup)}_getRenderPipelineDescriptor(){let e={module:this.props.vs.handle,entryPoint:this.props.vertexEntryPoint||"main",buffers:nr(this.shaderLayout,this.props.bufferLayout)},t=[];if(this.props.colorAttachmentFormats)for(let h of this.props.colorAttachmentFormats)t.push(h?{format:ne(h)}:null);else t.push({format:ne(this.device.preferredColorFormat)});let r={module:this.props.fs.handle,entryPoint:this.props.fragmentEntryPoint||"main",targets:t},n=this.device.createPipelineLayout({shaderLayout:this.shaderLayout}),s={vertex:e,fragment:r,primitive:{topology:this.props.topology},layout:n.handle},a=this.props.depthStencilAttachmentFormat||this.device.preferredDepthFormat;return this.props.parameters.depthWriteEnabled&&(s.depthStencil={format:ne(a)}),Zt(s,this.props.parameters),s}};o();var se=class extends j{device;handle=null;colorAttachments=[];depthStencilAttachment=null;constructor(e,t){super(e,t),this.device=e,this.autoCreateAttachmentTextures()}updateAttachments(){}};o();var ze=class extends Q{device;handle;_bindGroupLayout=null;_bindGroup=null;_bindings={};constructor(e,t){super(e,t),this.device=e;let r=this.props.shader;this.handle=this.props.handle||this.device.handle.createComputePipeline({label:this.props.id,compute:{module:r.handle,entryPoint:this.props.entryPoint,constants:this.props.constants},layout:"auto"})}setBindings(e){Object.assign(this._bindings,e)}_getBindGroup(){return this._bindGroupLayout=this._bindGroupLayout||this.handle.getBindGroupLayout(0),this._bindGroup=this._bindGroup||$e(this.device.handle,this._bindGroupLayout,this.shaderLayout,this._bindings),this._bindGroup}};o();var We=class extends Z{get[Symbol.toStringTag](){return"WebGPUVertexArray"}device;handle=null;constructor(e,t){super(e,t),this.device=e}destroy(){}setIndexBuffer(e){this.indexBuffer=e}setBuffer(e,t){this.attributes[e]=t}bindBeforeRender(e,t,r){let n=e,s=this.indexBuffer;s?.handle&&(d.info(3,"setting index buffer",s?.handle,s?.indexType)(),n.handle.setIndexBuffer(s?.handle,s?.indexType));for(let a=0;a<this.maxVertexAttributes;a++){let h=this.attributes[a];h?.handle&&(d.info(3,`setting vertex buffer ${a}`,h?.handle)(),n.handle.setVertexBuffer(a,h?.handle))}}unbindAfterRender(e){}static isConstantAttributeZeroSupported(e){return Xe()==="Chrome"}};o();var pe=class extends G{device;handle;depthStencilAttachment=null;get[Symbol.toStringTag](){return"WebGPUCanvasContext"}constructor(e,t,r){super(r);let n=this.canvas.getContext("webgpu");if(!n)throw new Error(`${this}: Failed to create WebGPU canvas context`);this.device=e,this.handle=n,this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this._updateDevice()}destroy(){this.handle.unconfigure(),super.destroy()}getCurrentFramebuffer(e={depthStencilFormat:"depth24plus"}){let t=this.getCurrentTexture();if(t.width!==this.drawingBufferWidth||t.height!==this.drawingBufferHeight){let[r,n]=this.getDrawingBufferSize();this.drawingBufferWidth=t.width,this.drawingBufferHeight=t.height,d.log(1,`${this}: Resized to compensate for initial canvas size mismatch ${r}x${n} => ${this.drawingBufferWidth}x${this.drawingBufferHeight}px`)()}return e?.depthStencilFormat&&this._createDepthStencilAttachment(e?.depthStencilFormat),new se(this.device,{colorAttachments:[t],depthStencilAttachment:this.depthStencilAttachment})}_updateDevice(){this.depthStencilAttachment&&(this.depthStencilAttachment.destroy(),this.depthStencilAttachment=null),this.handle.configure({device:this.device.handle,format:this.device.preferredColorFormat,colorSpace:this.props.colorSpace,alphaMode:this.props.alphaMode})}getCurrentTexture(){let e=this.handle.getCurrentTexture();return this.device.createTexture({id:`${this.id}#color-texture`,handle:e,format:this.device.preferredColorFormat,width:e.width,height:e.height})}_createDepthStencilAttachment(e){return this.depthStencilAttachment||(this.depthStencilAttachment=this.device.createTexture({id:`${this.id}#depth-stencil-texture`,usage:y.RENDER_ATTACHMENT,format:e,width:this.drawingBufferWidth,height:this.drawingBufferHeight})),this.depthStencilAttachment}};o();o();var Ue=class extends K{device;handle;constructor(e,t){super(e.device,{}),this.device=e.device,this.handle=this.props.handle||e.handle.finish({label:t?.id||"unnamed-command-buffer"})}};o();var ke=class extends C{device;handle;pipeline=null;constructor(e,t={}){super(e,t),this.device=e;let r=t.framebuffer||e.getCanvasContext().getCurrentFramebuffer(),n=this.getRenderPassDescriptor(r),s=t.timestampQuerySet;if(s&&(n.occlusionQuerySet=s.handle),e.features.has("timestamp-query")){let a=t.timestampQuerySet;n.timestampWrites=a?{querySet:a.handle,beginningOfPassWriteIndex:t.beginTimestampIndex,endOfPassWriteIndex:t.endTimestampIndex}:void 0}if(!e.commandEncoder)throw new Error("commandEncoder not available");this.device.pushErrorScope("validation"),this.handle=this.props.handle||e.commandEncoder.handle.beginRenderPass(n),this.device.popErrorScope(a=>{this.device.reportError(new Error(`${this} creation failed:
"${a.message}"`),this)(),this.device.debug()}),this.handle.label=this.props.id,d.groupCollapsed(3,`new WebGPURenderPass(${this.id})`)(),d.probe(3,JSON.stringify(n,null,2))(),d.groupEnd(3)()}destroy(){}end(){this.handle.end()}setPipeline(e){this.pipeline=e,this.device.pushErrorScope("validation"),this.handle.setPipeline(this.pipeline.handle),this.device.popErrorScope(t=>{this.device.reportError(new Error(`${this} setPipeline failed:
"${t.message}"`),this)(),this.device.debug()})}setBindings(e){this.pipeline?.setBindings(e);let t=this.pipeline?._getBindGroup();t&&this.handle.setBindGroup(0,t)}setIndexBuffer(e,t,r=0,n){this.handle.setIndexBuffer(e.handle,t,r,n)}setVertexBuffer(e,t,r=0){this.handle.setVertexBuffer(e,t.handle,r)}draw(e){e.indexCount?this.handle.drawIndexed(e.indexCount,e.instanceCount,e.firstIndex,e.baseVertex,e.firstInstance):this.handle.draw(e.vertexCount||0,e.instanceCount||1,e.firstIndex,e.firstInstance)}drawIndirect(){}setParameters(e){let{blendConstant:t,stencilReference:r,scissorRect:n,viewport:s}=e;t&&this.handle.setBlendConstant(t),r&&this.handle.setStencilReference(r),n&&this.handle.setScissorRect(n[0],n[1],n[2],n[3]),s&&this.handle.setViewport(s[0],s[1],s[2],s[3],s[4]??0,s[5]??1)}pushDebugGroup(e){this.handle.pushDebugGroup(e)}popDebugGroup(){this.handle.popDebugGroup()}insertDebugMarker(e){this.handle.insertDebugMarker(e)}beginOcclusionQuery(e){this.handle.beginOcclusionQuery(e)}endOcclusionQuery(){this.handle.endOcclusionQuery()}getRenderPassDescriptor(e){let t={colorAttachments:[]};if(t.colorAttachments=e.colorAttachments.map((r,n)=>({loadOp:this.props.clearColor!==!1?"clear":"load",clearValue:ii(this.props.clearColors?.[n]||this.props.clearColor||C.defaultClearColor),storeOp:this.props.discard?"discard":"store",view:r.handle})),e.depthStencilAttachment){t.depthStencilAttachment={view:e.depthStencilAttachment.handle};let{depthStencilAttachment:r}=t;this.props.depthReadOnly&&(r.depthReadOnly=!0),this.props.clearDepth!==!1&&(r.depthClearValue=this.props.clearDepth),!0&&(r.depthLoadOp=this.props.clearDepth!==!1?"clear":"load",r.depthStoreOp="store"),!1&&(r.stencilLoadOp=this.props.clearStencil!==!1?"clear":"load",r.stencilStoreOp="store")}return t}};function ii(i){return{r:i[0],g:i[1],b:i[2],a:i[3]}}o();var Oe=class extends q{device;handle;_webgpuPipeline=null;constructor(e,t){super(e,t),this.device=e;let r;if(e.features.has("timestamp-query")){let n=t.timestampQuerySet;n&&(r={querySet:n.handle,beginningOfPassWriteIndex:t.beginTimestampIndex,endOfPassWriteIndex:t.endTimestampIndex})}this.handle=this.props.handle||e.commandEncoder.handle.beginComputePass({label:this.props.id,timestampWrites:r})}destroy(){}end(){this.handle.end()}setPipeline(e){let t=e;this.handle.setPipeline(t.handle),this._webgpuPipeline=t,this.setBindings([])}setBindings(e){let t=this._webgpuPipeline._getBindGroup();this.handle.setBindGroup(0,t)}dispatch(e,t,r){this.handle.dispatchWorkgroups(e,t,r)}dispatchIndirect(e,t=0){let r=e;this.handle.dispatchWorkgroupsIndirect(r.handle,t)}pushDebugGroup(e){this.handle.pushDebugGroup(e)}popDebugGroup(){this.handle.popDebugGroup()}insertDebugMarker(e){this.handle.insertDebugMarker(e)}};var He=class extends J{device;handle;constructor(e,t={}){super(e,t),this.device=e,this.handle=t.handle||this.device.handle.createCommandEncoder({label:this.props.id}),this.handle.label=this.props.id}destroy(){}finish(e){this.device.pushErrorScope("validation");let t=new Ue(this,{id:e?.id||"unnamed-command-buffer"});return this.device.popErrorScope(r=>{let n=`${this} command encoding: ${r.message}. Maybe add depthWriteEnabled to your Model?`;this.device.reportError(new Error(n),this)(),this.device.debug()}),t}beginRenderPass(e){return new ke(this.device,e)}beginComputePass(e){return new Oe(this.device,e)}copyBufferToBuffer(e){let t=e.sourceBuffer,r=e.destinationBuffer;this.handle.copyBufferToBuffer(t.handle,e.sourceOffset??0,r.handle,e.destinationOffset??0,e.size??0)}copyBufferToTexture(e){let t=e.sourceBuffer,r=e.destinationTexture;this.handle.copyBufferToTexture({buffer:t.handle,offset:e.offset??0,bytesPerRow:e.bytesPerRow,rowsPerImage:e.rowsPerImage},{texture:r.handle,mipLevel:e.mipLevel??0,origin:e.origin??{}},{width:e.extent?.[0],height:e.extent?.[1],depthOrArrayLayers:e.extent?.[2]})}copyTextureToBuffer(e){}copyTextureToTexture(e){}pushDebugGroup(e){this.handle.pushDebugGroup(e)}popDebugGroup(){this.handle.popDebugGroup()}insertDebugMarker(e){this.handle.insertDebugMarker(e)}resolveQuerySet(e,t,r){let n=e,s=t;this.handle.resolveQuerySet(n.handle,r?.firstQuery||0,r?.queryCount||e.props.count-(r?.firstQuery||0),s.handle,r?.destinationOffset||0)}};o();var Ne=class extends ee{device;handle;constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.handle.createQuerySet({type:this.props.type,count:this.props.count}),this.handle.label=this.props.id}destroy(){this.handle?.destroy(),this.handle=null}};o();var Ve=class extends te{device;handle;constructor(e,t){super(e,t),this.device=e;let r=this.mapShaderLayoutToBindGroupEntries();this.handle=this.device.handle.createPipelineLayout({label:t?.id??"unnamed-pipeline-layout",bindGroupLayouts:[this.device.handle.createBindGroupLayout({label:"bind-group-layout",entries:r})]})}destroy(){this.handle=null}mapShaderLayoutToBindGroupEntries(){let e=[];for(let t=0;t<this.props.shaderLayout.bindings.length;t++){let r=this.props.shaderLayout.bindings[t],n={};switch(r.type){case"uniform":{n.buffer={type:"uniform",hasDynamicOffset:r.hasDynamicOffset,minBindingSize:r.minBindingSize};break}case"read-only-storage":{n.buffer={type:"read-only-storage",hasDynamicOffset:r.hasDynamicOffset,minBindingSize:r.minBindingSize};break}case"sampler":{n.sampler={type:r.samplerType};break}case"storage":{ni(r)?n.storageTexture={format:r.format,access:r.access,viewDimension:r.viewDimension}:n.buffer={type:"storage",hasDynamicOffset:r.hasDynamicOffset,minBindingSize:r.minBindingSize};break}case"texture":{n.texture={multisampled:r.multisampled,sampleType:r.sampleType,viewDimension:r.viewDimension};break}default:d.warn("unhandled binding type when creating pipeline descriptor")()}let s=GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE;e.push({binding:r.location,visibility:r.visibility||s,...n})}return e}},ni=i=>i.format!==void 0;var sr=class extends D{handle;adapter;adapterInfo;type="webgpu";preferredColorFormat=navigator.gpu.getPreferredCanvasFormat();preferredDepthFormat="depth24plus";features;info;limits;lost;canvasContext=null;_isLost=!1;commandEncoder;get[Symbol.toStringTag](){return"WebGPUDevice"}toString(){return`WebGPUDevice(${this.id})`}constructor(e,t,r,n){super({...e,id:e.id||"webgpu-device"}),this.handle=t,this.adapter=r,this.adapterInfo=n,this.info=this._getInfo(),this.features=this._getFeatures(),this.limits=this.handle.limits,t.addEventListener("uncapturederror",a=>{a.preventDefault();let h=a instanceof GPUUncapturedErrorEvent?a.error.message:"Unknown WebGPU error";this.reportError(new Error(h),this)(),this.debug()}),this.lost=new Promise(async a=>{let h=await this.handle.lost;this._isLost=!0,a({reason:"destroyed",message:h.message})});let s=D._getCanvasContextProps(e);s&&(this.canvasContext=new pe(this,this.adapter,s)),this.commandEncoder=this.createCommandEncoder({})}destroy(){this.handle.destroy()}get isLost(){return this._isLost}isVertexFormatSupported(e){return!this.getVertexFormatInfo(e).webglOnly}getTextureByteAlignment(){return 1}createBuffer(e){let t=this._normalizeBufferProps(e);return new ie(this,t)}createTexture(e){return new De(this,e)}createExternalTexture(e){return new Ie(this,e)}createShader(e){return new Re(this,e)}createSampler(e){return new B(this,e)}createRenderPipeline(e){return new Ge(this,e)}createFramebuffer(e){return new se(this,e)}createComputePipeline(e){return new ze(this,e)}createVertexArray(e){return new We(this,e)}createCommandEncoder(e){return new He(this,e)}createTransformFeedback(e){throw new Error("Transform feedback not supported in WebGPU")}createQuerySet(e){return new Ne(this,e)}createCanvasContext(e){return new pe(this,this.adapter,e)}createPipelineLayout(e){return new Ve(this,e)}submit(e){e||(e=this.commandEncoder.finish(),this.commandEncoder.destroy(),this.commandEncoder=this.createCommandEncoder({id:`${this.id}-default-encoder`})),this.pushErrorScope("validation"),this.handle.queue.submit([e.handle]),this.popErrorScope(t=>{this.reportError(new Error(`${this} command submission: ${t.message}`),this)(),this.debug()})}pushErrorScope(e){this.handle.pushErrorScope(e)}popErrorScope(e){this.handle.popErrorScope().then(t=>{t&&e(t)})}_getInfo(){let[e,t]=(this.adapterInfo.driver||"").split(" Version "),r=this.adapterInfo.vendor||this.adapter.__brand||"unknown",n=e||"",s=t||"",a=r==="apple"?"apple":"unknown",h=this.adapterInfo.architecture||"unknown",m=this.adapterInfo.backend||"unknown",x=(this.adapterInfo.type||"").split(" ")[0].toLowerCase()||"unknown";return{type:"webgpu",vendor:r,renderer:n,version:s,gpu:a,gpuType:x,gpuBackend:m,gpuArchitecture:h,shadingLanguage:"wgsl",shadingLanguageVersion:100}}_getFeatures(){let e=new Set(this.handle.features);e.has("depth-clamping")&&(e.delete("depth-clamping"),e.add("depth-clip-control")),e.has("texture-compression-bc")&&e.add("texture-compression-bc5-webgl");let t=["timer-query-webgl","compilation-status-async-webgl","float32-renderable-webgl","float16-renderable-webgl","norm16-renderable-webgl","texture-filterable-anisotropic-webgl","shader-noperspective-interpolation-webgl"];for(let r of t)e.add(r);return new de(Array.from(e),this.props._disabledFeatures)}_getDeviceSpecificTextureFormatCapabilities(e){let{format:t}=e;return t.includes("webgl")?{format:t,create:!1,render:!1,filter:!1,blend:!1,store:!1}:e}};export{U as a,d as b,g as c,mr as d,gr as e,_r as f,at as g,_ as h,y as i,N as j,Y as k,X as l,Q as m,Xt as n,wt as o,sr as p};
