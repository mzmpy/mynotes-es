import WebGLTransformF from '@/components/mdx/constituents/webgl/orthographic/transformF/index.jsx'

# `WebGL`三维正射投影

* 前边我们讲到了二维平面上的矩阵变换，看到了图形平移、旋转和缩放的效果并通过一个矩阵实现了这些操作，现在我们来看一下
在三维中这些操作是如何实现的

  * 首先要做的是确定所画图形的顶点坐标以及对应的颜色
    ```javascript
    const setGeometry = (gl) => {
      gl.bufferData(
        gl.ARRAY_BUFFER,
        new Float32Array([
          /* 前面 */
          // 左竖
          0, 0, 0.05,
          0, -0.6, 0.05,
          0.1, -0.6, 0.05,
          0.1, -0.6, 0.05,
          0.1, 0, 0.05,
          0, 0, 0.05,
  
          // 上横
          0.1, 0, 0.05,
          0.1, -0.1, 0.05,
          0.37, -0.1, 0.05,
          0.37, -0.1, 0.05,
          0.37, 0, 0.05,
          0.1, 0, 0.05,
  
          // 中横
          0.1, -0.25, 0.05,
          0.1, -0.35, 0.05,
          0.25, -0.35, 0.05,
          0.25, -0.35, 0.05,
          0.25, -0.25, 0.05,
          0.1, -0.25, 0.05,
  
          /* 背面 */
          // 左竖
          0, 0, -0.05,
          0.1, 0, -0.05,
          0.1, -0.6, -0.05,
          0.1, -0.6, -0.05,
          0, -0.6, -0.05,
          0, 0, -0.05,
  
          // 上横
          0.1, 0, -0.05,
          0.37, -0.1, -0.05,
          0.1, -0.1, -0.05,
          0.37, 0, -0.05,
          0.37, -0.1, -0.05,
          0.1, 0, -0.05,
  
          // 中横
          0.1, -0.25, -0.05,
          0.25, -0.25, -0.05,
          0.25, -0.35, -0.05,
          0.25, -0.35, -0.05,
          0.1, -0.35, -0.05,
          0.1, -0.25, -0.05,

          /* 顶面 */
          // 上顶
          0, 0, -0.05,
          0, 0, 0.05,
          0.37, 0, 0.05,
          0.37, 0, 0.05,
          0.37, 0, -0.05,
          0, 0, -0.05,

          // 中顶
          0.1, -0.25, -0.05,
          0.1, -0.25, 0.05,
          0.25, -0.25, 0.05,
          0.25, -0.25, 0.05,
          0.25, -0.25, -0.05,
          0.1, -0.25, -0.05,

          /* 底面 */
          // 上底
          0.1, -0.1, 0.05,
          0.1, -0.1, -0.05,
          0.37, -0.1, -0.05,
          0.37, -0.1, -0.05,
          0.37, -0.1, 0.05,
          0.1, -0.1, 0.05,

          // 中底
          0.1, -0.35, 0.05,
          0.1, -0.35, -0.05,
          0.25, -0.35, -0.05,
          0.25, -0.35, -0.05,
          0.25, -0.35, 0.05,
          0.1, -0.35, 0.05,

          // 下底
          0, -0.6, 0.05,
          0, -0.6, -0.05,
          0.1, -0.6, -0.05,
          0.1, -0.6, -0.05,
          0.1, -0.6, 0.05,
          0, -0.6, 0.05,

          /* 左侧面 */
          0, 0, -0.05,
          0, -0.6, -0.05,
          0, -0.6, 0.05,
          0, -0.6, 0.05,
          0, 0, 0.05,
          0, 0, -0.05,

          /* 右侧面 */
          // 上横右侧
          0.37, 0, 0.05,
          0.37, -0.1, 0.05,
          0.37, -0.1, -0.05,
          0.37, -0.1, -0.05,
          0.37, 0, -0.05,
          0.37, 0, 0.05,
  
          // 左竖右上侧
          0.1, -0.1, 0.05,
          0.1, -0.25, 0.05,
          0.1, -0.25, -0.05,
          0.1, -0.25, -0.05,
          0.1, -0.1, -0.05,
          0.1, -0.1, 0.05,
  
          // 左竖右下侧
          0.1, -0.35, 0.05,
          0.1, -0.6, 0.05,
          0.1, -0.6, -0.05,
          0.1, -0.6, -0.05,
          0.1, -0.35, -0.05,
          0.1, -0.35, 0.05,
  
          // 中横右侧
          0.25, -0.25, 0.05,
          0.25, -0.35, 0.05,
          0.25, -0.35, -0.05,
          0.25, -0.35, -0.05,
          0.25, -0.25, -0.05,
          0.25, -0.25, 0.05,
        ]),
        gl.STATIC_DRAW)
    }

    const setColors = (gl) => {
      gl.bufferData(
        gl.ARRAY_BUFFER,
        new Uint8Array([
          /* 前面 */
          // 左竖
          200, 70, 120,
          200, 70, 120,
          200, 70, 120,
          200, 70, 120,
          200, 70, 120,
          200, 70, 120,
  
          // 上横
          200, 70, 120,
          200, 70, 120,
          200, 70, 120,
          200, 70, 120,
          200, 70, 120,
          200, 70, 120,
  
          // 中横
          200, 70, 120,
          200, 70, 120,
          200, 70, 120,
          200, 70, 120,
          200, 70, 120,
          200, 70, 120,
  
          /* 背面 */
          // 左竖
          80, 70, 200,
          80, 70, 200,
          80, 70, 200,
          80, 70, 200,
          80, 70, 200,
          80, 70, 200,
  
          // 上横
          80, 70, 200,
          80, 70, 200,
          80, 70, 200,
          80, 70, 200,
          80, 70, 200,
          80, 70, 200,
  
          // 中横
          80, 70, 200,
          80, 70, 200,
          80, 70, 200,
          80, 70, 200,
          80, 70, 200,
          80, 70, 200,
  
          /* 顶面 */
          // 上顶
          70, 200, 210,
          70, 200, 210,
          70, 200, 210,
          70, 200, 210,
          70, 200, 210,
          70, 200, 210,
  
          // 中顶
          200, 200, 70,
          200, 200, 70,
          200, 200, 70,
          200, 200, 70,
          200, 200, 70,
          200, 200, 70,
  
          /* 底面 */
          // 上底
          210, 100, 70,
          210, 100, 70,
          210, 100, 70,
          210, 100, 70,
          210, 100, 70,
          210, 100, 70,
  
          // 中底
          210, 160, 70,
          210, 160, 70,
          210, 160, 70,
          210, 160, 70,
          210, 160, 70,
          210, 160, 70,
  
          // 下底
          70, 180, 210,
          70, 180, 210,
          70, 180, 210,
          70, 180, 210,
          70, 180, 210,
          70, 180, 210,
  
          /* 左侧面 */
          150, 70, 180,
          150, 70, 180,
          150, 70, 180,
          150, 70, 180,
          150, 70, 180,
          150, 70, 180,
  
          /* 右侧面 */
          // 上横右侧
          76, 210, 100,
          76, 210, 100,
          76, 210, 100,
          76, 210, 100,
          76, 210, 100,
          76, 210, 100,
  
          // 左竖右上侧
          140, 210, 80,
          140, 210, 80,
          140, 210, 80,
          140, 210, 80,
          140, 210, 80,
          140, 210, 80,
  
          // 左竖右下侧
          90, 130, 110,
          90, 130, 110,
          90, 130, 110,
          90, 130, 110,
          90, 130, 110,
          90, 130, 110,
  
          // 中横右侧
          160, 160, 220,
          160, 160, 220,
          160, 160, 220,
          160, 160, 220,
          160, 160, 220,
          160, 160, 220]),
        gl.STATIC_DRAW)
    }
    ```
  * 三维空间的旋转操作更加复杂，每个绕特定轴的旋转都可以分解成三部分；另外`WebGL`中还需要确定所谓的图像投影矩阵（这里使用的是正射投影）；
  为了能够正确渲染三维图像，还需要开启`WebGL`的相应特性
    ```javascript
    const translate3dMat = (dx, dy, dz) => {
      return [
        1,  0,  0,  0,
        0,  1,  0,  0,
        0,  0,  1,  0,
        dx, dy, dz, 1
      ]
    }

    const zRotate3dMat = (theta) => {
      return [
        Math.cos(theta),   Math.sin(theta), 0,  0,
        - Math.sin(theta), Math.cos(theta), 0,  0,
        0,                 0,               1,  0,
        0,                 0,               0, 1
      ]
    }

    const yRotate3dMat = (theta) => {
      return [
        Math.cos(theta), 0, - Math.sin(theta), 0,
        0,               1, 0,                 0,
        Math.sin(theta), 0, Math.cos(theta),   0,
        0,               0, 0,                 1
      ]
    }

    const xRotate3dMat = (theta) => {
      return [
        1, 0,                 0,               0,
        0, Math.cos(theta),   Math.sin(theta), 0,
        0, - Math.sin(theta), Math.cos(theta), 0,
        0, 0,                 0,               1
      ]
    }

    const projection3d = (width, height, depth) => {
      return [
        2 / width, 0,            0,         0,
        0,         - 2 / height, 0,         0,
        0,         0,            2 / depth, 0,
        0,         0,            0,         1,
      ]
    }

    ...

    // 开启该特性使WebGL只绘制正向三角形
    gl.enable(gl.CULL_FACE)
    // 开启该特性使WebGL能够使用深度缓存（DEPTH BUFFER）来绘制重叠的不同层次（z-index）的图像像素
    gl.enable(gl.DEPTH_TEST)
    ```

<WebGLTransformF></WebGLTransformF>