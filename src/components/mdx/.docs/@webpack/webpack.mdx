# `Webpack`

* æ¨¡å—åŒ–ï¼šæ¨¡å—åŒ–æŒ‡çš„æ˜¯åœ¨ç¨‹åºé¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå°†æ¶‰åŠçš„ä»£ç å’Œèµ„æºæ ¹æ®å…¶åŠŸèƒ½ã€ç±»åˆ«ç­‰å› ç´ åˆ†å‰²ï¼Œå°è£…åˆ°ä¸åŒçš„åŸŸï¼ˆä¾‹å¦‚æ–‡ä»¶ï¼Œä»£ç å—ç­‰ï¼‰
ä¸­ï¼Œä¸åŒä»£ç ä¹‹é—´å¯ä»¥äº’ç›¸å¼•ç”¨ï¼Œæ‰€æœ‰çš„ä»£ç èµ„æºæœ€ç»ˆéƒ½ç›´æ¥æˆ–è€…é—´æ¥åœ°è¢«å¯¼å…¥åˆ°ç¨‹åºçš„å…¥å£æ–‡ä»¶ä¸­ä½¿ç”¨ï¼›ä»£ç çš„æ¨¡å—åŒ–å¯ä»¥é¡¹ç›®æ›´åŠ ç»“æ„åŒ–ï¼Œ
é™ä½ä»£ç ä¹‹é—´çš„è€¦åˆï¼Œæ–¹ä¾¿å¯¹ç¨‹åºçš„å¼€å‘å’Œç»´æŠ¤

* æ¨¡å—åŒ–è§„èŒƒï¼š`CommonJS`ã€`AMD`ã€`UMD`ã€`ESModules`
  * ESM (ECMAScript Modules): è¿™æ˜¯JavaScript ES6ä¸­å¼•å…¥çš„å®˜æ–¹æ ‡å‡†æ¨¡å—ç³»ç»Ÿï¼›ä½¿ç”¨`import`å’Œ
  `export`è¯­å¥æ¥å¯¼å…¥å’Œå¯¼å‡ºæ¨¡å—
  * CommonJS: ä¸»è¦ç”¨äºNode.jsï¼Œå…è®¸ä½¿ç”¨`require()`æ¥åŠ è½½æ¨¡å—å’Œ`module.exports`æ¥å¯¼å‡ºæ¨¡å—
  * AMD (Asynchronous Module Definition): ç”¨äºå¼‚æ­¥åŠ è½½æ¨¡å—ï¼Œå¹¶ä½¿ç”¨`define`æ–¹æ³•æ¥å®šä¹‰æ¨¡å—
  * UMD (Universal Module Definition): ç»“åˆäº†AMDå’ŒCommonJSçš„ç‰¹ç‚¹ï¼Œå¹¶æ”¯æŒå…¨å±€å˜é‡å®šä¹‰çš„æ–¹å¼ï¼Œ
  ä½¿å¾—æ¨¡å—å¯ä»¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸Šè¿è¡Œ

* `webpack`è§£å†³äº†ä¸€ä¸‹é—®é¢˜ï¼š
  * æ¨¡å—åŒ–ï¼šå¼€å‘è¿‡ç¨‹ä¸­å¯¹`javascript`ã€`css`ã€`html`ã€`json`ã€`å›¾ç‰‡`ç­‰æ–‡ä»¶èµ„æºçš„æ¨¡å—åŒ–ï¼ŒåŒ…æ‹¬å¯¼å…¥å¯¼å‡ºç­‰
  * ä»£ç å…¼å®¹ï¼šä½¿ç”¨ä¸€äº›é«˜çº§çš„ç‰¹æ€§æ¥åŠ å¿«æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡æˆ–è€…å®‰å…¨æ€§ï¼Œæ¯”å¦‚é€šè¿‡`ES6+`ã€`TypeScript`å¼€å‘è„šæœ¬é€»è¾‘ï¼Œä½¿ç”¨`pollify`æ”¯æŒ
  ä¸åŒçš„æµè§ˆå™¨å’Œç‰ˆæœ¬ç­‰ï¼Œé€šè¿‡`sass`ã€`less`ç­‰æ–¹å¼æ¥ç¼–å†™cssæ ·å¼ä»£ç 
  * çƒ­æ¨¡å—æ›´æ–°(HMR)ï¼šç›‘å¬æ–‡ä»¶çš„å˜åŒ–æ¥å¹¶ä¸”åæ˜ åˆ°æµè§ˆå™¨ä¸Šï¼Œæé«˜å¼€å‘çš„æ•ˆç‡
  * ä»£ç ä¼˜åŒ–ï¼šå¼€å‘åæœŸæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘ä»£ç çš„å‹ç¼©ã€åˆå¹¶ä»¥åŠç›¸å…³ä¼˜åŒ–ç­‰

* `webpack`æ˜¯ä¸€ä¸ªç”¨äºç°ä»£`JavaScript`åº”ç”¨ç¨‹åºçš„é™æ€æ¨¡å—æ‰“åŒ…å·¥å…·ï¼›é™æ€æ¨¡å—æŒ‡çš„æ˜¯å¼€å‘é˜¶æ®µ`webpack`èƒ½å¤Ÿç›´æ¥å¼•ç”¨çš„èµ„æºï¼›`webpack`
åœ¨æ‰“åŒ…ä»£ç çš„æ—¶å€™ï¼Œå…¶å†…éƒ¨ä¼šç”Ÿæˆä¸€ä¸ªä¾èµ–å›¾ï¼Œä¾èµ–å›¾å¯¹åº”æ˜ å°„åˆ°å¼•ç”¨çš„æ¯ä¸ªæ¨¡å—

* `webpack`çš„è¿è¡Œæµç¨‹æ˜¯ä¸€ä¸ªä¸²è¡Œçš„è¿‡ç¨‹ï¼Œå®ƒçš„å·¥ä½œè¿‡ç¨‹å°±æ˜¯å°†å„ä¸ªæ’ä»¶ä¸²è”èµ·æ¥ï¼›æ•´ä¸ªå·¥ä½œæµç¨‹å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š
  * åˆå§‹åŒ–æµç¨‹ï¼šä»é…ç½®æ–‡ä»¶å’Œ`Shell`è¯­å¥ä¸­è¯»å–ä¸åˆå¹¶å‚æ•°ï¼Œå¹¶åˆå§‹åŒ–éœ€è¦ä½¿ç”¨çš„æ’ä»¶å’Œé…ç½®æ’ä»¶ç­‰æ‰§è¡Œç¯å¢ƒæ‰€éœ€è¦çš„å‚æ•°
  * ç¼–è¯‘æ„å»ºæµç¨‹ï¼šä»å…¥å£æ–‡ä»¶å‡ºå‘ï¼Œé’ˆå¯¹æ¯ä¸ªæ¨¡å—ä¸²è¡Œè°ƒç”¨å¯¹åº”çš„`Loader`è§£ææ–‡ä»¶å†…å®¹ï¼Œå†æ‰¾åˆ°è¯¥æ¨¡å—ä¾èµ–çš„æ¨¡å—ï¼Œé€’å½’åœ°è¿›è¡Œç¼–è¯‘å¤„ç†
  * è¾“å‡ºæµç¨‹ï¼šå°†ç¼–è¯‘åçš„ä»£ç ç»„åˆæˆ`Chunk`ï¼ŒæŠŠ`Chunk`è½¬æ¢æˆæ–‡ä»¶ï¼Œè¾“å‡ºåˆ°æ–‡ä»¶ç³»ç»Ÿ

* `Plugin`æ˜¯ä¸€ç§è®¡ç®—æœºåº”ç”¨ç¨‹åºï¼Œå®ƒå’Œä¸»åº”ç”¨ç¨‹åºäº’ç›¸äº¤äº’ï¼Œä»¥æä¾›ç‰¹å®šçš„åŠŸèƒ½
* `webpack`çš„`plugin`ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œ`plugin`å¯ä»¥æä¾›ä¾‹å¦‚æ‰“åŒ…ä¼˜åŒ–ã€èµ„æºç®¡ç†ã€ç¯å¢ƒå˜é‡æ³¨å…¥ç­‰åŠŸèƒ½
* `plugin`å¯ä»¥è¿è¡Œåœ¨`webpack`çš„ä¸åŒé˜¶æ®µï¼ˆé’©å­/ç”Ÿå‘½å‘¨æœŸï¼‰ï¼Œè´¯ç©¿`webpack`çš„æ•´ä¸ªç¼–è¯‘å‘¨æœŸ
* ç¼–è¯‘ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œæœ‰å¦‚ä¸‹ï¼š
  * `entry-option`ï¼šåˆå§‹åŒ–`option`
  * `run`
  * `compile`ï¼šçœŸæ­£å¼€å§‹çš„ç¼–è¯‘ï¼Œåœ¨åˆ›å»º`compilation`å¯¹è±¡ä¹‹å‰
  * `compilation`ï¼šç”Ÿæˆå¥½äº†`compilation`å¯¹è±¡
  * `make`ï¼šä»`entry`å¼€å§‹é€’å½’åˆ†æä¾èµ–ï¼Œå‡†å¤‡å¯¹æ¯ä¸ªæ¨¡å—è¿›è¡Œ`build`
  * `after-compile`ï¼šç¼–è¯‘`build`è¿‡ç¨‹ç»“æŸ
  * `emit`ï¼šåœ¨å°†å†…å­˜ä¸­`assets`å†…å®¹å†™åˆ°ç£ç›˜æ–‡ä»¶å¤¹ä¹‹å‰
  * `after-emit`ï¼šåœ¨å°†å†…å­˜ä¸­`assets`å†…å®¹å†™åˆ°ç£ç›˜æ–‡ä»¶å¤¹ä¹‹å
  * `done`ï¼šå®Œæˆæ‰€æœ‰çš„ç¼–è¯‘è¿‡ç¨‹
  * `failed`ï¼šç¼–è¯‘å¤±è´¥çš„æ—¶å€™

* `webpack proxy`ï¼Œå³`webpack`æä¾›çš„ä»£ç†æœåŠ¡åŠŸèƒ½ï¼›åŸºæœ¬è¡Œä¸ºå°±æ˜¯æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚åè½¬å‘ç»™å…¶ä»–æœåŠ¡å™¨ï¼›å…¶ç›®çš„æ˜¯ä¸ºäº†ä¾¿äºå¼€å‘è€…
åœ¨å¼€å‘æ¨¡å¼ä¸‹è§£å†³è·¨åŸŸé—®é¢˜ï¼ˆæµè§ˆå™¨å®‰å…¨ç­–ç•¥é™åˆ¶ï¼‰

* `webpack`é…ç½®é¡¹`mode`ï¼š`string: none|developement|production`ï¼Œç”¨äºæŒ‡å®š`webpack`æ„å»ºæƒ…æ™¯å¹¶è‡ªåŠ¨ä½¿ç”¨ç›¸åº”çš„ä¼˜åŒ–
  * `developement`: ä¸»è¦ä½“ç°åœ¨å¢é‡æ„å»ºå’Œå¼€å‘ä½“éªŒï¼ˆä¾‹å¦‚çƒ­æ¨¡å—æ›¿æ¢ã€source mapã€proxyç­‰ï¼‰ä¸Šçš„ä¼˜åŒ–
  * `production`ï¼šä¸»è¦ä½“ç°åœ¨ä»£ç å‹ç¼©ã€Tree Shakingç­‰æ–¹é¢çš„ä¼˜åŒ–

## `webpack`ä»£ç åˆ†ç¦»ï¼š

  * å…¥å£é…ç½®ï¼šä»¥lodashä¸ºä¾‹ï¼Œå°†å›ºå®šå¤ç”¨çš„ä»£ç å†™åœ¨ä¸€ä¸ªjsæ–‡ä»¶ä¸­ï¼Œç„¶åæ”¾åœ¨`entry`å…¥å£é…ç½®é‡Œï¼ˆè¯¥
  æ–¹æ³•æœ‰éšæ‚£ä¸”ä¸å¤Ÿçµæ´»ï¼Œå»ºè®®è°¨æ…ä½¿ç”¨ğŸ˜ï¼‰

    ```javascript
    // è¿™ç§æ–¹å¼ä¼šå¯¼è‡´å¦‚æœ'./src/lodash.js'å’Œ'./src/index.js'å¯¼å…¥äº†ç›¸åŒæ¨¡å—Xçš„æ—¶å€™ï¼Œæ¨¡å—X
    // ä¼šè¢«é‡å¤æ‰“åŒ…
    const HtmlWebpackPlugin = require('html-webpack-plugin');
    const path = require('path');
    module.exports = {
      mode: 'development',
      entry: {
        lodash: './src/lodash.js', // æ³¨æ„é¡ºåºï¼Œlodash å†™åœ¨å‰é¢
        index: './src/index.js' // è¿™æ · index.js çš„ä»£ç æ‰èƒ½ç”¨åˆ° lodash
      },
      output: {
        filename: '[name].js',
        path: path.resolve(__dirname, 'dist'),
      },
      plugins: [
        new HtmlWebpackPlugin({
          filename: 'index.html'
        })
      ]
    }

    // å¦ä¸€ç§æ”¹è¿›çš„æ–¹æ³•ï¼Œé¿å…é‡å¤æ‰“åŒ…
    const HtmlWebpackPlugin = require('html-webpack-plugin');
    const path = require('path');
    module.exports = {
      mode: 'development',
      entry: {
        lodash: {
          import: './src/lodash.js',
          dependOn: 'shared'
        },
        index: {
          import: './src/index.js',
          dependOn: 'shared'
        },
        shared: 'lodash'
      },
      output: {
        filename: '[name].js',
        path: path.resolve(__dirname, 'dist'),
      },
      optimization: {
        runtimeChunk: 'single'
      },
      plugins: [
        new HtmlWebpackPlugin({
          filename: 'index.html'
        })
      ]
    }
    ```
  * Code Splittingï¼š
    * å¼‚æ­¥ä»£ç åˆ†ç¦»ï¼ˆé»˜è®¤ï¼Œå¼‚æ­¥å¼•ç”¨çš„ä»£ç ä¸º`import('path/to/async/code.js')`ï¼‰ï¼š`webpack`æä¾›äº†ä»£ç åˆ†ç¦»çš„
    ç‰¹æ€§ï¼Œé»˜è®¤æ˜¯å°†å¼‚æ­¥ä»£ç æŒ‰ç…§ä»¥ä¸‹æ–¹å¼è¿›è¡Œä»£ç åˆ†ç¦»

      ```javascript
      module.exports = {
        //...
        optimization: {
          splitChunks: {
            chunks: 'async', // åŒæ­¥ or å¼‚æ­¥ï¼Œè¿™é‡Œæ˜¯å¼‚æ­¥
            minSize: 20000, // å¦‚æœæ¨¡å—å¤§å°å°äº20kbï¼Œåˆ™ä¸ä¼šè¢«åˆ†å‰²
            minRemainingSize: 0, // æœ€å°å¯ä¿å­˜å¤§å°ï¼Œå¼€å‘æ¨¡å¼ä¸‹ä¸º 0ï¼Œå…¶ä»–æƒ…å†µä¸‹ç­‰äº minSizeï¼Œä¸€èˆ¬ä¸ç”¨æ‰‹åŠ¨é…ç½®
            minChunks: 1, // å¦‚æœæ¨¡å—è¢«å¼•ç”¨æ¬¡æ•°å°äºè¿™ä¸ªå€¼ï¼Œåˆ™ä¸ä¼šè¢«åˆ†å‰²
            maxAsyncRequests: 30, // å¼‚æ­¥æ¨¡å—ï¼Œä¸€æ¬¡æœ€å¤šè¢«åŠ è½½çš„æ¬¡æ•°
            maxInitialRequests: 30, // å…¥å£æ¨¡å—æœ€å¤šè¢«åŠ è½½çš„æ¬¡æ•°
            enforceSizeThreshold: 50000, // å¼ºåˆ¶åˆ†å‰²çš„å¤§å°é˜ˆå€¼ 50kb
            cacheGroups: { // ç¼“å­˜ç»„
              // æ‰“åŒ…ç¬¬ä¸‰æ–¹åº“
              defaultVendors: {
                test: /[\\/]node_modules[\\/]/, // æ­£åˆ™åŒ¹é…ç¬¬ä¸‰æ–¹åº“æ–‡ä»¶
                priority: -10, // ä¼˜å…ˆçº§
                reuseExistingChunk: true, // å¦‚æœä¸€ä¸ªæ¨¡å—å·²ç»è¢«æ‰“åŒ…è¿‡äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¨¡å—ä¹Ÿä¸ä¼šè¢«æ‰“åŒ…
              },
              // æ‰“åŒ…å…¬å…±æ¨¡å—
              default: {
                minChunks: 2, // è¢«è¶…è¿‡ä¸¤ä¸ªæ¨¡å—å¼•ç”¨ï¼Œæ‰ä¼šè¢«æ‰“åŒ…
                priority: -20, // ä¼˜å…ˆçº§
                reuseExistingChunk: true, // å¦‚æœä¸€ä¸ªæ¨¡å—å·²ç»è¢«æ‰“åŒ…è¿‡äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¨¡å—ä¹Ÿä¸ä¼šè¢«æ‰“åŒ…
              },
            }
          }
        }
      }
      ```
    * åŒæ­¥ä»£ç åˆ†ç¦»ï¼š`optimization.splitChunks.chunks`çš„å€¼è®¾ç½®ä¸º`all`ï¼Œå®ƒè¡¨ç¤ºï¼šä¸ç®¡åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Œéƒ½ä¼šè¿›è¡Œä»£ç åˆ†ç¦»
      ```javascript
      module.exports = {
        //...
        optimization: {
          splitChunks: {
            chunks: 'all', // åŒæ­¥æˆ–å¼‚æ­¥
            minSize: 100, // è‡ªå·±è®¾ç½®æœ€å°åˆ†å‰²å¤§å°
            cacheGroups: { // ç¼“å­˜ç»„
              // æ‰“åŒ…ç¬¬ä¸‰æ–¹åº“
              defaultVendors: {
                test: /[\\/]node_modules[\\/]/, // æ­£åˆ™åŒ¹é…ç¬¬ä¸‰æ–¹åº“æ–‡ä»¶
                priority: -10, // ä¼˜å…ˆçº§
                reuseExistingChunk: true, // å¦‚æœä¸€ä¸ªæ¨¡å—å·²ç»è¢«æ‰“åŒ…è¿‡äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¨¡å—ä¹Ÿä¸ä¼šè¢«æ‰“åŒ…
                filename: 'vendors.js' // æ‰“åŒ…åçš„æ–‡ä»¶å
              },
              // æ‰“åŒ…å…¬å…±æ¨¡å—
              default: {
                minChunks: 2, // è¢«è¶…è¿‡ä¸¤ä¸ªæ¨¡å—å¼•ç”¨ï¼Œæ‰ä¼šè¢«æ‰“åŒ…ï¼ˆå¯ä»¥å»æ‰ï¼‰
                priority: -20, // ä¼˜å…ˆçº§
                reuseExistingChunk: true, // å¦‚æœä¸€ä¸ªæ¨¡å—å·²ç»è¢«æ‰“åŒ…è¿‡äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¨¡å—ä¹Ÿä¸ä¼šè¢«æ‰“åŒ…
                filename: 'common.js' // æ‰“åŒ…åçš„æ–‡ä»¶å
              },
            }
          }
        }
      }
      ```
  * é¢„è·å–/é¢„åŠ è½½æ¨¡å—ï¼š
    * é¢„è·å–`prefetch`ï¼šåœ¨æµè§ˆå™¨åŠ è½½å®Œå¿…è¦çš„èµ„æºåï¼Œç©ºé—²æ—¶å°±ä¼šå»è·å–å¯èƒ½éœ€è¦çš„èµ„æº
    * é¢„åŠ è½½`preload`ï¼šé¢„å…ˆåŠ è½½å½“å‰é¡µé¢å¯èƒ½éœ€è¦çš„èµ„æºï¼Œå®ƒä¸å¿…è¦èµ„æºå¹¶è¡Œè¯·æ±‚

    ```javascript
    // ä½¿ç”¨æ³¨é‡Šâ€œ/* webpackPrefetch: true */â€å‘Šè¯‰webpackè¿›è¡Œé¢„è·å–
    import(/* webpackPrefetch: true */ './assets/js/click.js')
    // ä½¿ç”¨æ³¨é‡Šâ€œ/* webpackPreload: true */â€å‘Šè¯‰webpackè¿›è¡Œé¢„åŠ è½½
    import(/* webpackPreload: true */ 'ChartingLibrary');
    ```
  * cssä»£ç åˆ†ç¦»ï¼šä½¿ç”¨`MiniCssExtractPlugin.loader`å–ä»£`style-loader`è¿›è¡Œcssä»£ç åˆ†ç¦»


## `webpack`æ„å»ºæ€§èƒ½ä¼˜åŒ–ï¼š

  * åˆ†æå·¥å…·ï¼š`webpackbar`ã€`speed-measure-webpack-plugin`ã€`webpack-bundle-analyzer`
  * å¤šçº¿ç¨‹æ„å»ºï¼š
    * ä½¿ç”¨`thread-loader`ï¼šæ”¾ç½®åœ¨æ­¤`loader`ä¹‹åçš„`loader`ä¼šåœ¨ä¸€ä¸ªç‹¬ç«‹çš„`worker`æ± ä¸­è¿è¡Œ

      ```javascript
      module.exports = {
        ...
        module:{
          rules:[
            {
                test: /\.js$/,
                use: ['thread-loader','babel-loader']
            }
          ]
        },
        ...
      }
      ```

  * ä½¿ç”¨ç¼“å­˜æé«˜äºŒæ¬¡æ„å»ºé€Ÿåº¦ï¼š
    * ä½¿ç”¨`cache-loader`ï¼šåœ¨ä¸€äº›æ€§èƒ½å¼€é”€è¾ƒå¤§çš„`loader`ä¹‹å‰æ·»åŠ æ­¤`cache-loader`ï¼Œä»¥å°†ç»“æœç¼“å­˜åˆ°ç£ç›˜ä¸­

      ```javascript
      module.exports = {
        ...
        module: {
          rules: [
            {
              test: /\.js$/,
              use: ['cache-loader','babel-loader']
            }
          ]
        }
        ...
      }
      ```

    * å¯¹äº`babel-loader`å¯ä»¥ç›´æ¥åœ¨`babel-loader`åé¢åŠ ä¸Š`?cacheDirectory=true`ä½¿ç”¨ç¼“å­˜

      ```javascript
      module.exports = {
        ...
        module: {
          rules: [
            {
              test: /\.js$/,
              use: ['babel-loader?cacheDirectory=true']
            }
          ]
        }
        ...
      }
      ```

  * ä½¿ç”¨åŠ¨æ€é“¾æ¥åº“ï¼š

    * ä½¿ç”¨`DllPlugin`æ‰“åŒ…ç¬¬ä¸‰æ–¹åº“ï¼šæ–°å»ºä¸€ä¸ª`webpack`é…ç½®æ–‡ä»¶`webpack.dll.js`ç”¨äºæ‰“åŒ…ç¬¬ä¸‰æ–¹åº“

      ```javascript
      const path = require('path')
      const webpack = require('webpack')

      module.exports = {
        mode: 'production',
        entry: {
          three: ['three', 'dat.gui']   // ç¬¬ä¸‰æ–¹åº“æ•°ç»„
        },
        output: {
          filename: '[name].dll.js',    //[name]å°±æ˜¯åœ¨entry
          path: path.resolve(__dirname, 'dist/lib'),
          library: '[name]'
        },
        plugins: [
          new webpack.DllPlugin({
            name: '[name]',
            path: path.resolve(__dirname, 'dist/lib/[name].json') //manifest.jsonçš„å­˜æ”¾ä½ç½®
          })
        ]
      }
      ```

    * ä½¿ç”¨`DLLReferencePlugin`å¼•ç”¨`manifest.json`ï¼Œå»å…³è”ä¸Šä¸€æ­¥ä¸­å·²ç»æ‰“å¥½çš„åŒ…

      ```javascript
      const path = require('path')
      const webpack = require('webpack')
      const AddAssetHtmlPlugin = require('add-asset-html-webpack-plugin'); // é¡¾åæ€ä¹‰ï¼ŒæŠŠèµ„æºåŠ åˆ° html é‡Œï¼Œé‚£è¿™ä¸ªæ’ä»¶æŠŠ dll åŠ å…¥åˆ° index.html é‡Œ
      module.exports = {
        ...
        plugins:[
          //ä¿®æ”¹CleanWebpackPluginé…ç½®
          new CleanWebpackPlugin({
            cleanOnceBeforeBuildPatterns: [  
              '!lib/**'              //åœ¨æ¯æ¬¡æ¸…æ¥šdistç›®å½•æ—¶ï¼Œä¸æ¸…ç†libæ–‡ä»¶å¤¹çš„å†…å®¹
            ]
          }),
          // dllç›¸å…³é…ç½®
          new webpack.DllReferencePlugin({    
            // å°†manifestå­—æ®µé…ç½®æˆæˆ‘ä»¬ç¬¬1æ­¥ä¸­æ‰“åŒ…å‡ºæ¥çš„jsonæ–‡ä»¶
            context: __dirname,
            manifest: require('./dist/lib/three.json')  
          }),
          new AddAssetHtmlPlugin({
            filepath: path.resolve(__dirname, 'dist/lib/three.dll.js'),
            publicPath: './'
          })
        ]
        ...
      }
      ```

  * `include`/`exclude`ï¼šé€šå¸¸æ¥è¯´ï¼Œ`loader`ä¼šå¤„ç†ç¬¦åˆåŒ¹é…è§„åˆ™çš„æ‰€æœ‰æ–‡ä»¶ï¼›æ¯”å¦‚`babel-loader`ä¼šéå†é¡¹ç›®ä¸­ç”¨åˆ°çš„æ‰€æœ‰`js`æ–‡ä»¶ï¼Œ
  å¯¹æ¯ä¸ªæ–‡ä»¶çš„ä»£ç è¿›è¡Œç¼–è¯‘è½¬æ¢ï¼›è€Œ`node_modules`é‡Œçš„`js`æ–‡ä»¶åŸºæœ¬ä¸Šéƒ½æ˜¯è½¬è¯‘å¥½äº†çš„ï¼Œä¸éœ€è¦å†æ¬¡å¤„ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨`include/exclude`
  æ¥å¸®æˆ‘ä»¬é¿å…è¿™ç§ä¸å¿…è¦çš„è½¬è¯‘

    ```javascript
    module.exports = {
      ...
      module:{
        rules:[
          {
              test: /\.js$/,
              use: ['babel-loader'],
              exclude: /node_modules/
              //æˆ–è€…  include: [path.resolve(__dirname, 'src')]
          }
        ]
      },
      ...
    }
    ```

  * ä¼˜åŒ–`resolve.alias`ã€`resolve.modules`ã€`resolve.extensions`
    * `resolve.alias`ï¼šç»™å¸¸ç”¨è·¯å¾„å®šä¹‰åˆ«åï¼Œå‡å°‘è·¯å¾„æŸ¥æ‰¾è¿‡ç¨‹
    * `resolve.modules`ï¼šç”¨äºé…ç½®`webpack`å»å“ªäº›ç›®å½•ä¸‹å¯»æ‰¾ç¬¬ä¸‰æ–¹æ¨¡å—
    * `resolve.extensions`ï¼šå¦‚æœæœ‰å¤šä¸ªæ–‡ä»¶æœ‰ç›¸åŒçš„åå­—ï¼Œä½†åç¼€åä¸åŒï¼Œ`webpack`ä¼šæŒ‰ç…§`extensions`æ•°ç»„ä¸­åç¼€çš„é¡ºåºåŒ¹é…å¹¶ä½¿
    ç”¨ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°çš„æ–‡ä»¶

    ```javascript
    module.exports = {
      ...
      resolve:{
        alias:{
          "@": path.resolve(__dirname,'./src')
        },
        modules: [path.resolve(__dirname, 'node_modules')],
        // extensions: ['.js', '.json', '.wasm'], /* webpacké»˜è®¤æŒ‰ç…§æ­¤åˆ—è¡¨é¡ºåºåŒ¹é…æ–‡ä»¶ */
        extensions: ['.ts', ...], // æ­¤é…ç½®ä¼šè¦†ç›–é»˜è®¤æ‰©å±•æ•°ç»„ï¼Œå¹¶ä½¿ç”¨ ... æ¥è®¿é—®é»˜è®¤æ‰©å±•å
      },
      ...
    }
    ```

## å‰ç«¯ä»£ç æ€§èƒ½ä¼˜åŒ–

  * å›¾ç‰‡ä¼˜åŒ–ï¼š

    * å›¾ç‰‡å‹ç¼©
    * å›¾ç‰‡æ¸è¿›åŠ è½½ä¼˜åŒ–ï¼ˆæ¸è¿›å¼å›¾ç‰‡çš„åŠ è½½æµç¨‹åˆ™æ˜¯å…ˆæ˜¾ç¤ºå›¾ç‰‡æ•´ä½“çš„ä¸€ä¸ªæ¨¡ç³Šæ•ˆæœï¼Œéšç€ä¸‹è½½æ•°æ®çš„å¢å¤šï¼Œé€æ¸ç»†åŒ–å›¾ç‰‡ä¸­çš„å„ä¸ª
    ç»†èŠ‚ï¼Œä½¿å¾—å›¾ç‰‡åˆ†è¾¨ç‡é€æ¸æé«˜ï¼Œæœ€ç»ˆè¿˜åŸå‡ºå®Œæ•´çš„å›¾åƒå†…å®¹ï¼‰
    * å°å›¾ç‰‡ï¼ˆä¾‹å¦‚ï¼š`<10k`ï¼‰ä½¿ç”¨Data URI
    * å›¾ç‰‡é›ªç¢§å›¾ï¼ˆä½¿ç”¨å¤šä¸ªå°å›¾ç‰‡æ‹¼æ¥å¤§å›¾ç‰‡ï¼‰

  * ä»£ç å‹ç¼©ä¼˜åŒ–
  * å‡å°‘é¡µé¢å›æµå’Œé‡ç»˜
  * æ‡’åŠ è½½/é¢„åŠ è½½
  * å¤§é‡æ•°æ®æ¸²æŸ“ä¼˜åŒ–
  * åˆç†ä½¿ç”¨ç¼“å­˜
  